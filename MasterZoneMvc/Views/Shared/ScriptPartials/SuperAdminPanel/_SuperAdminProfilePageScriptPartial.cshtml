<script>
    var UserToken_Global = "";
    var SuperId_Global = 0;
    $(document).ready(function () {

        $.get("/SuperAdmin/GetSuperAdminToken", null, function (dataAdminToken) {
            if (dataAdminToken != "" && dataAdminToken != null) {

                UserToken_Global = dataAdminToken;
                EditSuperAdminProfile();
            }
            else {
                $.get("/SuperAdmin/GetSubAdminToken", null, function (dataAdminToken) {
                    if (dataAdminToken != "" && dataAdminToken != null) {

                        UserToken_Global = dataAdminToken;
                        EditSuperAdminProfile();
                    }
                });
            }
        });
    });


    document.getElementById('fileProfileImage_ManageSuperAdmin').addEventListener('change', handleProfileImageUpload);

function handleProfileImageUpload(event) {
    const file = event.target.files[0];
    const fileSize = file.size / 1024; // size in kilobytes
    const maxSize = 1024*1024; // maximum size in kilobytes
    const fileType = file.type;
    const validImageTypes = ['image/jpeg', 'image/png'];

    if (!validImageTypes.includes(fileType)) {
        $.iaoAlert({
            msg: '@(Resources.SuperAdminPanel.ValidImageFile_ErrorMessage)',
            type: "error",
            mode: "dark",
        });
        event.target.value = null; // clear the file input element
        $('#previewImage').addClass('d-none'); // hide the preview image
        return;
    }
    if (fileSize > maxSize) {
        $.iaoAlert({
            msg: '@(String.Format(Resources.SuperAdminPanel.ValidFileSize_ErrorMessage, "1 MB"))',
            type: "error",
            mode: "dark",
        });
        event.target.value = null; // clear the file input element
        $('#previewImage').addClass('d-none'); // hide the preview image

        return;
    }

    // image size is within the limit, display the preview image
    const reader = new FileReader();
    reader.onload = function (event) {
        document.getElementById('previewImage').src = event.target.result;
        $('#previewImage').removeClass('d-none');
    }

    reader.readAsDataURL(file);
}

    ////// -----------    FIELD VALIDATION HANDLER FUNCTIONS  --------------------------

    const validate_IsEmptyStringInputFieldValue = function (inputFieldValue) {
        if (inputFieldValue == '' || inputFieldValue.replace(/\s/g, "") == "")
            return true;
        return false;
    }

    const validate_IsEmptySelectInputFieldValue = function (inputFieldValue) {
        if (inputFieldValue == undefined || inputFieldValue == null || inputFieldValue == '' || inputFieldValue == 0)
            return true;
        return false;
    }
////// -----------    FIELD VALIDATION HANDLER FUNCTIONS  --------------------------

    // To Add SuperAdmin Basic Detail
      function btnSubmitSuperAdmin() {

    let is_valid = true;
        $(".error-class").html('');
         var _mode = 1;
          let _superAdminFirstName = $("#txtFirstName").val().trim();
          let _superAdminLastName = $("#txtLastName").val().trim();
          let _superAdminEmail = $("#txtEmail").val().trim();
          let _superAdminPhoneNumber = $("#txtContactNumber").val().trim();

          let _error_superAdminFirstName = $("#error_txtFirstName");
          let _error_superAdminLastName = $("#error_txtLastName");
          let _error_superAdminEmail = $("#error_txtEmail");
          let _error_superAdminPhoneNumber = $("#error_txtContactNumber");

         var TestEmail = /^([\w-\.]+)@@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([\w-]+\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\]?)$/;
          var phone_test = /^[\+]?[(]?[0-9]{3}[)]?[-\s\.]?[0-9]{3}[-\s\.]?[0-9]{4,6}$/im;

          if (validate_IsEmptyStringInputFieldValue(_superAdminFirstName)) {
        is_valid = false;
             _error_superAdminFirstName.html('@(Resources.SuperAdminPanel.FirstNameRequired)');
         }
          if (validate_IsEmptyStringInputFieldValue(_superAdminLastName)) {
        is_valid = false;
              _error_superAdminLastName.html('@(Resources.SuperAdminPanel.LastNameRequired)');
         }

          if (validate_IsEmptyStringInputFieldValue(_superAdminEmail)) {
        is_valid = false;
             _error_superAdminEmail.html('@(Resources.SuperAdminPanel.EmailRequired)');
          }
          else if (!TestEmail.test(_superAdminEmail)) {
            is_valid = false;
              _error_superAdminEmail.html('@(Resources.SuperAdminPanel.ValidEmailRequired)');
          }
          if (validate_IsEmptyStringInputFieldValue(_superAdminPhoneNumber)) {
        is_valid = false;
             _error_superAdminPhoneNumber.html('@(Resources.SuperAdminPanel.PhoneNumberRequired)');
          }
          else if (!phone_test.test(_superAdminPhoneNumber)) {
            is_valid = false;
              _error_superAdminPhoneNumber.html('@(Resources.SuperAdminPanel.ValidPhoneNumberRequired)');
        }



    if (is_valid) {
        var data = new FormData();
        data.append("Id", SuperId_Global);
        data.append("FirstName", _superAdminFirstName);
        data.append("LastName", _superAdminLastName);
        data.append("Email", _superAdminEmail);
        data.append("PhoneNumber", _superAdminPhoneNumber);
        data.append("Mode", _mode);

        $.ajax({
            url: "/api/SuperAdmin/Profile/AddUpdate",
            headers: {
                "Authorization": "Bearer " + UserToken_Global
            },
            data: data,
            processData: false,
            mimeType: "multipart/form-data",
            contentType: false,
            //contentType: 'application/json',
            type: "POST",
            success: function (dataResponse) {

                //--Parse into Json of response-json-string
                dataResponse = JSON.parse(dataResponse);

                //--If successfully added/updated
                if (dataResponse.status === 1) {
                    swal("Success!", dataResponse.message, "success");
                    EditSuperAdminProfile();
                }
                else {
                    swal({
                        title: '',
                        imageUrl: '/Content/svg/error.svg',
                        text: dataResponse.message
                    });

                    //StopLoading();

                }

            },
            error: function (result) {
                //StopLoading();


                if (result["status"] == 401) {
                    $.iaoAlert({
                        msg: 'Unauthorized! Invalid Token!',
                        type: "error",
                        mode: "dark",
                    });
                }
                else {
                    $.iaoAlert({
                        msg: 'There is some technical error, please try again!',
                        type: "error",
                        mode: "dark",
                    });
                }
            }
        });
    }

    }

    // To Get SuperAdmin Profile Detail
     function EditSuperAdminProfile() {

         var _url = "/api/SuperAdmin/Profile/Get/";

    StartLoading();

    $.ajax({
        type: "GET",
        url: _url,
        headers: {
            "Authorization": "Bearer " + UserToken_Global,
            "Content-Type": "application/json"
        },
        contentType: 'application/json',
        success: function (response) {
            if (response.status < 1) {
                $.iaoAlert({
                    msg: response.message,
                    type: "error",
                    mode: "dark",
                });
                return;
            }

            $("#txtFirstName").val(response.data.FirstName);
            $("#txtLastName").val(response.data.LastName);
            $("#txtEmail").val(response.data.Email);
            $("#txtContactNumber").val(response.data.PhoneNumber);
            $("#fileProfileImage_ManageSuperAdmin").val('');
            if (response.data.ProfileImageWithPath != "") {
                $("#previewImage").attr('src', response.data.ProfileImageWithPath);
                $("#previewImage").removeClass('d-none');
            }


            StopLoading();
        },
        error: function (result) {
            StopLoading();

            if (result["status"] == 401) {
                $.iaoAlert({
                    msg: '@(Resources.ErrorMessage.UnAuthorizedErrorMessage)',
                    type: "error",
                    mode: "dark",
                });
            }
            else {
                $.iaoAlert({
                    msg: '@(Resources.ErrorMessage.TechincalErrorMessage)',
                    type: "error",
                    mode: "dark",
                });
            }
        }
    });
    }

    // To Add SuperAdmin Profile Image Detail
      function btnAddUpdateSuperAdminProfileImage()
      {
          var _SuperAdminProfileImageFile_MS = $("#fileProfileImage_ManageSuperAdmin").get(0);
          var _SuperAdminProfileImageFiles = _SuperAdminProfileImageFile_MS.files;
          $("#fileProfileImage_ManageSuperAdmin").html('');

          if (_SuperAdminProfileImageFiles.length <= 0) {
              $("#error_fileProfileImage_ManageSuperAdmin").html('@(Resources.SuperAdminPanel.PleaseSelectAnImage_ErrorMessage)');
            return;
        }

        var data = new FormData();
          data.append('ProfileImage', _SuperAdminProfileImageFiles[0]);

         $.ajax({
             url: '/api/SuperAdmin/Profile/AddUpdateProfileImage',
                headers: {
                    "Authorization": "Bearer " + UserToken_Global
                },
                data: data,
                processData: false,
                mimeType: 'multipart/form-data',
                contentType: false,
                //contentType: 'application/json',
                type: 'POST',
                success: function (dataResponse) {

                    //--Parse into Json of response-json-string
                    dataResponse = JSON.parse(dataResponse);

                    //--If successfully added/updated
                    if (dataResponse.status === 1) {
                        swal("Success!", dataResponse.message, "success");
                    }
                    else {
                        swal({
                            title: 'Error!',
                            icon: 'error',
                            text: dataResponse.message
                        });
                        StopLoading();

                        return;
                    }


                    StopLoading();
                    EditSuperAdminProfile();

                    //GetStatesLists();
                    //GetCitiesList();
                    initMap();
                },
                error: function (result) {
                    StopLoading();

                    if (result["status"] == 401) {
                        $.iaoAlert({
                            msg: '@(Resources.ErrorMessage.UnAuthorizedErrorMessage)',
                            type: "error",
                            mode: "dark",
                        });
                    }
                    else {
                        $.iaoAlert({
                            msg: '@(Resources.ErrorMessage.TechincalErrorMessage)',
                            type: "error",
                            mode: "dark",
                        });
                    }
                }
            });

    }


    // Update Masterzone Logo
    function btnAddUpdateMasterzoneLogo()
    {
        var _MasterzoneLogoImageFile_MS = $("#fileMasterlogo_ManageSuperAdmin").get(0);
        var _MasterzoneLogoImageFiles = _MasterzoneLogoImageFile_MS.files;
        $("#fileMasterlogo_ManageSuperAdmin").html('');

        if (_MasterzoneLogoImageFiles.length <= 0) {
            $("#error_fileMasterlogo_ManageSuperAdmin").html('@(Resources.SuperAdminPanel.PleaseSelectAnImage_ErrorMessage)');
            return;
        }

        var data = new FormData();
        data.append('Image', _MasterzoneLogoImageFiles[0]);

        $.ajax({
            url: '/api/SuperAdmin/UpdateMasterzoneLogo',
            headers: {
                "Authorization": "Bearer " + UserToken_Global
            },
            data: data,
            processData: false,
            mimeType: 'multipart/form-data',
            contentType: false,
            //contentType: 'application/json',
            type: 'POST',
            success: function (dataResponse) {

                //--Parse into Json of response-json-string
                dataResponse = JSON.parse(dataResponse);

                //--If successfully added/updated
                if (dataResponse.status === 1) {
                    swal("Success!", dataResponse.message, "success");
                }
                else {
                    swal({
                        title: 'Error!',
                        icon: 'error',
                        text: dataResponse.message
                    });
                    StopLoading();

                    return;
                }

                StopLoading();
            },
            error: function (result) {
                StopLoading();

                if (result["status"] == 401) {
                    $.iaoAlert({
                        msg: '@(Resources.ErrorMessage.UnAuthorizedErrorMessage)',
                        type: "error",
                        mode: "dark",
                    });
                }
                else {
                    $.iaoAlert({
                        msg: '@(Resources.ErrorMessage.TechincalErrorMessage)',
                        type: "error",
                        mode: "dark",
                    });
                }
            }
        });

    }

    document.getElementById('fileMasterlogo_ManageSuperAdmin').addEventListener('change', handleMasterzoneImageUpload);

function handleMasterzoneImageUpload(event) {
    const file = event.target.files[0];
    const fileSize = file.size / 1024; // size in kilobytes
    const maxSize = 1024*1024; // maximum size in kilobytes
    const fileType = file.type;
    const validImageTypes = ['image/png'];

    if (!validImageTypes.includes(fileType)) {
        $.iaoAlert({
            msg: '@(Resources.ErrorMessage.OnlyPNGImageValid_ErrorMessage)',
            type: "error",
            mode: "dark",
        });
        event.target.value = null; // clear the file input element
        $('#previewMasterlogo').addClass('d-none'); // hide the preview image
        return;
    }
    if (fileSize > maxSize) {
        $.iaoAlert({
            msg: '@(String.Format(Resources.SuperAdminPanel.ValidFileSize_ErrorMessage, "10 MB"))',
            type: "error",
            mode: "dark",
        });
        event.target.value = null; // clear the file input element
        $('#previewMasterlogo').addClass('d-none'); // hide the preview image

        return;
    }

    // image size is within the limit, display the preview image
    const reader = new FileReader();
    reader.onload = function (event) {
        document.getElementById('previewMasterlogo').src = event.target.result;
        $('#previewMasterlogo').removeClass('d-none');
    }

    reader.readAsDataURL(file);
}
</script>
