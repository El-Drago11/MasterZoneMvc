<script>

    var UserToken_Global = "";
    var _CourseCategoryTable = 0;
    function initializeDataTable_CourseCategoryDetail() {
        _CourseCategoryTable = $("#tblCourseCategoryDetailView").DataTable();
    }

    $(document).ready(function () {
        StartLoading();
        $.get("/SuperAdmin/GetSuperAdminToken", null, function (dataAdminToken) {
            if (dataAdminToken != "" && dataAdminToken != null) {
                UserToken_Global = dataAdminToken;
                initializeDataTable_CourseCategoryDetail();
                GetAllBusinessContentCourseCategoryPagination();
                StopLoading();
            }
            else {


            }
            //StopLoading();
        });
    });



         ///Course Category  Section

    $('#AddCourseCategory').click(function () {
        $('#AddNewCourseCategory').show();
        $('#AllCourseCategory').hide();
    });


    function ResetBusinessCourseCategoryDetail() {
        $("#fileProfileImage_ManageCourseCategoryImage").val('');
        $('#previewimageCourseCategoryImagePreview').addClass('d-none');
        $("#previewimageCourseCategoryImagePreview").attr('src', '');
        $("#text_description").val('');
        $("#txtTitle").val('');
        $('#AllCourseCategory').show();
        $('#AddNewCourseCategory').hide();
        CourseCategoryId_Global = 0;
    }

    var CourseCategoryId_Global = 0;



      // Image File Preview -------------------------------------------------------------
    document.getElementById('fileProfileImage_ManageCourseCategoryImage').addEventListener('change', handleCourseCategoryImageUpload);

    function handleCourseCategoryImageUpload(event) {
    const file = event.target.files[0];
    const fileSize = file.size / 1024; // size in kilobytes
    const maxSize = 10*1024*1024; // maximum size in kilobytes
    const fileType = file.type;
    const validImageTypes = ['image/jpeg', 'image/png'];

    if (!validImageTypes.includes(fileType)) {
        $.iaoAlert({
            msg: '@(Resources.BusinessPanel.ValidImageTypesRequired)',
            type: "error",
            mode: "dark",
        });
        event.target.value = null; // clear the file input element
        $('#previewimageCourseCategoryImagePreview').addClass('d-none'); // hide the preview image
        return;
    }
    if (fileSize > maxSize) {
        $.iaoAlert({
            msg: '@(String.Format(Resources.BusinessPanel.FileSizeRequired, "10 MB"))',
            type: "error",
            mode: "dark",
        });
        event.target.value = null; // clear the file input element
        $('#previewimageCourseCategoryImagePreview').addClass('d-none'); // hide the preview image

        return;
    }

    // image size is within the limit, display the preview image
    const reader = new FileReader();
    reader.onload = function (event) {
        document.getElementById('previewimageCourseCategoryImagePreview').src = event.target.result;
        $('#previewimageCourseCategoryImagePreview').removeClass('d-none');
    }

    reader.readAsDataURL(file);
}

    function GetCourseCategoryDataById(id) {
       // $("#collapseAddLanguageService").modal('show');
        //$(".error-class").html('');
        //document.getElementById("Modal_Title").innerHTML = "Edit Language Detail";


        var _url = "/api/Business/GetBusinessContentCourseCategoryDetail?id=" +id ;

    StartLoading();

    $.ajax({
        type: "GET",
        url: _url,
        headers: {
            "Authorization": "Bearer " + UserToken_Global,
            "Content-Type": "application/json"
        },
        contentType: 'application/json',
        success: function (response) {
            if (response.status < 1) {
                $.iaoAlert({
                    msg: response.message,
                    type: "error",
                    mode: "dark",
                });
                return;
            }
           CourseCategoryId_Global = response.data.Id;
            $("#txtTitle").val(response.data.Title);
            $("#text_description").val(response.data.Description);
            $("#fileProfileImage_ManageCourseCategoryImage").val('');
            if (response.data.CourseCategoryImageWithPath != "") {
                $("#previewimageCourseCategoryImagePreview").attr('src', response.data.CourseCategoryImageWithPath);
                $("#previewimageCourseCategoryImagePreview").removeClass('d-none');
        }



            StopLoading();
        },
        error: function (result) {
            StopLoading();

            if (result["status"] == 401) {
                $.iaoAlert({
                    msg: '@(Resources.ErrorMessage.UnAuthorizedErrorMessage)',
                    type: "error",
                    mode: "dark",
                });
            }
            else {
                $.iaoAlert({
                    msg: '@(Resources.ErrorMessage.TechincalErrorMessage)',
                    type: "error",
                    mode: "dark",
                });
            }
        }
    });
    }




    function EditBusinessContentCourseCategoryDetail(id) {
        $('#AddNewCourseCategory').show();
        $('#AllCourseCategory').hide();
        document.getElementById("ToChangeUpdateText").innerHTML = "Update";
        document.getElementById("ToChangeTextTitle").innerHTML = "Edit Course Category";
        document.getElementById("TochangeHeader").innerHTML = "Edit Course Category";
        document.getElementById("pageUpTextChange").innerHTML = "Edit Course Category";
        $(".error-class").html('');
        $('#AddCourseCategory').click(function () {
            document.getElementById("ToChangeTextTitle").innerHTML = "Add Course Category";
            document.getElementById("TochangeHeader").innerHTML = "Add Course Category";
            document.getElementById("pageUpTextChange").innerHTML = "Add Course Category";
            document.getElementById("ToChangeUpdateText").innerHTML = "Save";
            $(".error-class").html('');
        });
        GetCourseCategoryDataById(id);
        $(".error-class").html('');
    }

    ////// -----------    FIELD VALIDATION HANDLER FUNCTIONS  --------------------------

    const validate_IsEmptyStringInputFieldValue = function (inputFieldValue) {
        if (inputFieldValue == '' || inputFieldValue.replace(/\s/g, "") == "")
            return true;
        return false;
    }

    const validate_IsEmptySelectInputFieldValue = function (inputFieldValue) {
        if (inputFieldValue == undefined || inputFieldValue == null || inputFieldValue == '' || inputFieldValue == 0)
            return true;
        return false;
    }
    ////// -----------    FIELD VALIDATION HANDLER FUNCTIONS  --------------------------

    function btnSubmitBusinessContentCourseCategoryClick() {

        let is_valid = true;
        $(".error-class").html('');
        var _mode = (CourseCategoryId_Global > 0) ? 2 : 1;


         let _manageTitle = $("#txtTitle").val().trim();
         let _managedescription = $("#text_description").val().trim();

        let _error_manageCourseCategory = $("#error_fileProfileImage_ManageCourseCategoryImage");

         let _error_managedescription = $("#error_text_description");


        let _error_manageTitle = $("#error_txtTitle");

        var _coursecategoryImageFile_MS = $("#fileProfileImage_ManageCourseCategoryImage").get(0);
        var _coursecategoryImageFiles = _coursecategoryImageFile_MS.files;


        if (validate_IsEmptyStringInputFieldValue(_manageTitle)) {
           is_valid = false;
           _error_manageTitle.html('@(Resources.SuperAdminPanel.TitleRequired)');
        }

        if (validate_IsEmptyStringInputFieldValue(_managedescription)) {
           is_valid = false;
            _error_managedescription.html('@(Resources.SuperAdminPanel.DescriptionRequired)');
        }

       if (_mode == 1 && _coursecategoryImageFiles.length <= 0) {
           is_valid = false;
           _error_manageCourseCategory.html('@(Resources.SuperAdminPanel.BusinessCourseCategoryImageRequired)');
           return;
       }


        if (is_valid) {

            var data = new FormData();

            data.append("Id", CourseCategoryId_Global);
            data.append("Title", _manageTitle);
            data.append("CourseCategoryImage", _coursecategoryImageFiles[0]);
            data.append("Description", _managedescription);
            data.append("Mode", _mode);




            $.ajax({
                url: '/api/Business/AddUpdateBusinessCourseCategory',
                headers: {
                    "Authorization": "Bearer " + UserToken_Global
                },
                data: data,
                processData: false,
                mimeType: 'multipart/form-data',
                contentType: false,
                //contentType: 'application/json',
                type: 'POST',
                success: function (dataResponse) {

                    //--Parse into Json of response-json-string
                    dataResponse = JSON.parse(dataResponse);


                    //--If successfully added/updated
                    if (dataResponse.status === 1) {
                        swal("Success!", dataResponse.message, "success");
                        GetAllBusinessContentCourseCategoryPagination();
                    }
                    else {
                        swal({
                            title: 'Error!',
                            icon: 'error',
                            text: dataResponse.message
                        });
                        StopLoading();

                        return;
                    }

                   // EditBusinessProfile();
                    StopLoading();

                },
                error: function (result) {
                    StopLoading();

                    if (result["status"] == 401) {
                        $.iaoAlert({
                            msg: '@(Resources.ErrorMessage.UnAuthorizedErrorMessage)',
                            type: "error",
                            mode: "dark",
                        });
                    }
                    else {
                        $.iaoAlert({
                            msg: '@(Resources.ErrorMessage.TechincalErrorMessage)',
                            type: "error",
                            mode: "dark",
                        });
                    }
                }
            });
        }

    }




    function ConfirmDeleteDeleteCourseCategoryDetail(sid) {
        swal({
            title: "@(Resources.SuperAdminPanel.ConfirmDeleteDeleteCourseCategoryTitle)",
            text: "@(Resources.SuperAdminPanel.ConfirmDeleteDeleteCourseCategoryText)",
            type: "warning",
            buttons: true,
            cancel: {
                text: "@(Resources.ErrorMessage.Cancel)",
                value: null,
                visible: false,
                className: "",
                closeModal: true,
            }
        }).then((willDelete) => {
            if (willDelete) {
                DeleteCourseCategory(sid);
            } else {
                //swal("Your imaginary file is safe!");
            }
        });
    }

    function DeleteCourseCategory(sid) {
        StartLoading();
        $.ajax({
            type: "POST",
            url: "/api/Business/DeleteCourseCategoryDetail?id=" + sid,
            headers: {
                "Authorization": "Bearer " + UserToken_Global,
                "Content-Type": "application/json"
            },
            contentType: 'application/json',
            success: function (dataResponse) {
                StopLoading();

                //--Check if staff successfully deleted
                if (dataResponse.status == 1) {
                    setTimeout(function () {
                        swal("Success!", dataResponse.message, "success");
                        GetAllBusinessContentCourseCategoryPagination();
                    }, 100);
                }
                else {
                    $.iaoAlert({
                        msg: '@(Resources.ErrorMessage.TechincalErrorMessage)',
                        type: "error",
                        mode: "dark",
                    });
                }
            },
            error: function (result) {
                StopLoading();

                if (result["status"] == 401) {
                    $.iaoAlert({
                        msg: '@(Resources.ErrorMessage.UnAuthorizedErrorMessage)',
                        type: "error",
                        mode: "dark",
                    });
                }
                else {
                    $.iaoAlert({
                        msg: '@(Resources.ErrorMessage.TechincalErrorMessage)',
                        type: "error",
                        mode: "dark",
                    });
                }
            }
        });
    }

    function GetAllBusinessContentCourseCategoryPagination() {
    var _url_val = "/api/Business/GetAllBusinessContentCourseCategoryByPagination";
    _CourseCategoryTable.clear().destroy();
    _CourseCategoryTable = $("#tblCourseCategoryDetailView").DataTable({
        "processing": true,
        "serverSide": true,
        "filter": true,
        "orderMulti": false,
        "ordering": true,
        "paginate": true,
        "order": [[3, "desc"]],
        "ajax": {
            "headers": {
                "Authorization": "Bearer " + UserToken_Global
            },
            "url": _url_val,
            "type": "POST",
            "error": function (result) {
                if (result["status"] == 401) {
                    $.iaoAlert({
                        msg: '@(Resources.ErrorMessage.UnAuthorizedErrorMessage)',
                        type: "error",
                        mode: "dark",
                    });
                }
                else {
                    $.iaoAlert({
                        msg: '@(Resources.ErrorMessage.TechincalErrorMessage)',
                        type: "error",
                        mode: "dark",
                    });
                }
            }
        },
        "columns": [
            {
                "data": "SerialNumber", "name": "SerialNumber", "autoWidth": true
            },
            {
                "data": null, "": "CourseCategoryImage", "autoWidth": true,
                "render": function (data, type, row) {
                    var _Image = (row.CourseCategoryImageWithPath == '') ? '' : '<img src="' + row.CourseCategoryImageWithPath + '" class="imageCourseCategoryImagePreview"/>';
                    return _Image;
                }
            },
            { "data": "Title", "name": "Title", "autoWidth": true },
            {
                "data": "Description",
                "name": "Description",
                "autoWidth": true,
                "render": function (data, type, row) {
                    var maxLength = 150; // Maximum length to show initially
                    var description = data;
                    var readMoreHtml = '<a href="#" class="read-more">Read more</a>';
                    var showLessHtml = '<a href="#" class="read-less">Show less</a>';
                    if (description.length > maxLength) {
                        var trimmedDescription = description.substr(0, maxLength);
                       
                    }
                    if (description.length < maxLength) {
                        return '<span class="description"><span class="full-description">' + description + '.';

                    } else {

                    return '<span class="description"><span class="full-description d-none">' + description + '...' + showLessHtml+ '</span ><span class="truncated-description">' + trimmedDescription + '...' + readMoreHtml+'</span></span> ';
                    }
                }
            },

            {
                "data": null, "": "Action", "autowidth": true,
                "render": function (data, type, row) {
                    var _edit = '';
                    var _delete = '';

                    _edit = `<a href="javascript:EditBusinessContentCourseCategoryDetail(${row.Id});"><i class="fas fa-edit" title="Edit"></i></a>`;
                    _delete = `<a href="javascript:ConfirmDeleteDeleteCourseCategoryDetail(${row.Id});"><i class="fas fa-trash" title="Delete"></i></a>`;

                    var _action = `<div class="edbt">${_edit}${_delete}</div>`;
                    return _action;
                }
            }
        ],
        "responsive": true,
        "autoWidth": false,
        "columnDefs": [{
            "targets": [4], // column index (start from 0)
            "orderable": false, // set orderable false for selected columns
        }]
    });

        $(document).on('click', '.read-more', function (e) {
            e.preventDefault();
            $(this).closest('.description').find('.full-description').removeClass('d-none');
                $(this).closest('.description').find('.truncated-description').addClass('d-none');
        });
        $(document).on('click', '.read-less', function (e) {
            e.preventDefault();
            $(this).closest('.description').find('.full-description').addClass('d-none');
                $(this).closest('.description').find('.truncated-description').removeClass('d-none');
        });



    // Enable search box to only send request on pressing enter
    $('#tblCourseCategoryDetailView_filter input').unbind();
    $('#tblCourseCategoryDetailView_filter input').bind('keyup', function (e) {
        if (e.keyCode == 13 || (e.keyCode == 8 && $(this).val() == '')) {
            _CourseCategoryTable.search(this.value).draw();
        }
    });
}



</script>


