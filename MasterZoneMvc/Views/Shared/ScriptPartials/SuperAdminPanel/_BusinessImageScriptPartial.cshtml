
<script>
    var BusinessId_Global = 0;
    var UserToken_Global = "";

    $(document).ready(function () {
        StartLoading();
        $.get("/SuperAdmin/GetSuperAdminToken", null, function (dataAdminToken) {
            if (dataAdminToken != "" && dataAdminToken != null) {
                UserToken_Global = dataAdminToken;
                GetBusinessImageDetailById();

                StopLoading();
            }
            else {
                $.get("/SuperAdmin/GetSubAdminToken", null, function (dataAdminToken) {
                    if (dataAdminToken != "" && dataAdminToken != null) {
                        UserToken_Global = dataAdminToken;
                        GetBusinessImageDetailById();

                        StopLoading();
                    }
                    else {
                        StopLoading();
                    }
                });
            }
        });
    });


    function GetBusinessImageDetailById() {
        
        var _businessOwnerLoginId = $("#businessOwnerLoginId").val();
        var _url = "/api/Business/BusinessDetailById?businessOwnerLoginId=" + _businessOwnerLoginId;
    
        $.ajax({
            type: "GET",
            url: _url,
            headers: {
                "Authorization": "Bearer " + UserToken_Global,
                "Content-Type": "application/json"
            },
            contentType: 'application/json',
            success: function (response) {
                if (response.status < 1) {
                    $.iaoAlert({
                        msg: response.message,
                        type: "error",
                        mode: "dark",
                    });
                    return;
                }

                var htmlData2 = '';
                for (var i = 0; i < response.data.BusinessImageDetailResponse.length; i++) {
                    htmlData2 += `              <div class="card m-2">
                                                    <div class="card-body">
                                                        <div class="d-flex flex-column">
                                                            <img  src="${response.data.BusinessImageDetailResponse[i].ImageWithPath}" class="previewImage">
                                                            <a class="btn btn-xs btn-danger m-2" onclick="ConfirmUserImageDelete(${response.data.BusinessImageDetailResponse[i].BusinessOwnerLoginId},${response.data.BusinessImageDetailResponse[i].Id})">Delete</a>
                                                        </div>
                                                    </div>
                                                </div>
                                     `;
                }
                if (response.data.BusinessImageDetailResponse.length <= 0) {
                    htmlData2 += `<div class="w-100 font-italic text-center text-black-50 py-2">No Images in this Business Detail.</div>`;
                }
                $('#ViewBusinessImageDetail').append(htmlData2);

            },

            error: function(result) {
                StopLoading();

                if (result["status"] == 401) {
                    $.iaoAlert({
                        msg: '@(Resources.ErrorMessage.UnAuthorizedErrorMessage)',
                        type: "error",
                        mode: "dark",
                    });
                }
                else {
                    $.iaoAlert({
                        msg: '@(Resources.ErrorMessage.TechincalErrorMessage)',
                        type: "error",
                        mode: "dark",
                    });
                }
            }
        });
    }

    function ConfirmUserImageDelete(UserLoginId , Id) {
        
    swal({
        title: "@(Resources.SuperAdminPanel.ConfirmDeleteBusinessImageTitle)",
        text: "@(Resources.SuperAdminPanel.ConfirmDeleteBusinessImageText)",
        type: "warning",
        buttons: true,
        cancel: {
            text: "@(Resources.ErrorMessage.Cancel)",
            value: null,
            visible: false,
            className: "",
            closeModal: true,
        }
    }).then((willDelete) => {
        if (willDelete) {
            DeleteBusinessContentImageDetail(UserLoginId, Id); 
        } else {
            //swal("Your imaginary file is safe!");
        }
    });
}

    function DeleteBusinessContentImageDetail(UserLoginId, Id) {
        
        StartLoading();

    $.ajax({
        type: "POST",
        url: "/api/Business/DeleteBusinessContentImageBySuperAdmin?id=" + Id + "&UserLoginId=" + UserLoginId,
        headers: {
            "Authorization": "Bearer " + UserToken_Global,
            "Content-Type": "application/json"
        },
        contentType: 'application/json',
        success: function (dataResponse) {
            StopLoading();

            //--Check if staff successfully deleted
            if (dataResponse.status == 1) {
                setTimeout(function () {
                    swal("Success!", dataResponse.message, "success");
                    GetBusinessImageDetailById();

                }, 100);
            }
            else {
                $.iaoAlert({
                    msg: '@(Resources.ErrorMessage.TechincalErrorMessage)',
                    type: "error",
                    mode: "dark",
                });
            }
        },
        error: function (result) {
            StopLoading();

            if (result["status"] == 401) {
                $.iaoAlert({
                    msg: '@(Resources.ErrorMessage.UnAuthorizedErrorMessage)',
                    type: "error",
                    mode: "dark",
                });
            }
            else {
                $.iaoAlert({
                    msg: '@(Resources.ErrorMessage.TechincalErrorMessage)',
                    type: "error",
                    mode: "dark",
                });
            }
        }
    });
}
</script>