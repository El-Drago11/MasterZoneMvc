<script>
    var UserToken_Global = "";
    var TokenId_Global = $("#hiddentoken").val();

    $(document).ready(function () {
        //$.get("/Business/GetBusinessAdminToken", null, function (dataToken) {
        //    if (dataToken != "" && dataToken != null) {
        //        UserToken_Global = dataToken;

        //        StopLoading();
        //    }
        //    else {
        //        $.get("/Business/GetStaffToken", null, function (dataToken) {
        //            if (dataToken != "" && dataToken != null) {
        //                UserToken_Global = dataToken;

        //            }
        //            else {
        //                StopLoading();
        //            }
        //        });
        //    }
        //});
    });

    function resetPasswordSuccessfullView() {
        $('#sectionResetForm').addClass('d-none');
        $('#sectionLinkExpired').addClass('d-none');
        $('#sectionSuccessMessage').removeClass('d-none');
    }

    function linkExpriredView() {
        $('#sectionResetForm').addClass('d-none');
        $('#sectionSuccessMessage').addClass('d-none');
        $('#sectionLinkExpired').removeClass('d-none');
    }

    function ResetAddView() {
        $("#text_Password").val('');
        $("#text_ConfirmPassword").val('');

    }

    function btnSubmitResetPasswordClick() {
        let is_valid = true;
        $(".error-class").html('');

        let _password = $("#text_Password").val().trim();
        let _confirmPassword = $("#text_ConfirmPassword").val().trim();

        let _error_password = $("#error_text_Password");
        let _error_confirmPassword = $("#error_text_ConfirmPassword");


        if (validate_IsEmptyStringInputFieldValue(_password)) {
            is_valid = false;
            _error_password.html('@(Resources.BusinessPanel.PasswordRequired)');
        }
        else if (validate_IsEmptyStringInputFieldValue(_confirmPassword)) {
            is_valid = false;
            _error_confirmPassword.html('@(Resources.BusinessPanel.ConfirmPasswordRequired)');
        }
        else if (_confirmPassword != _password) {
            is_valid = false;
            _error_confirmPassword.html("@(Resources.BusinessPanel.PasswordNotMatch_ErrorMessage)");
        }


        if (is_valid) {
            var data = {
                Password: _password,
                ConfirmPassword: _confirmPassword,
                Token: TokenId_Global
            };
            StartLoading();
            $.ajax({
                url: '/api/Login/ResetPassword',
                headers: {
                    //"Authorization": "Bearer " + UserToken_Global,
                    "Content-Type": "application/json"
                },
                data: JSON.stringify(data),
                contentType: 'application/json',
                type: "POST",

                success: function (dataResponse) {
                    //--If successfully added/updated
                    if (dataResponse.status === 1) {
                        resetPasswordSuccessfullView();
                    }
                    else if (dataResponse.status == -2) {
                        // Link has been expired.
                        linkExpriredView();
                    }
                    else {
                        swal({
                            title: 'Error!',
                            icon: 'error',
                            text: dataResponse.message
                        });
                        StopLoading();

                        return;
                    }

                    ResetAddView();
                    StopLoading();

                },
                error: function (result) {
                    StopLoading();

                    if (result["status"] == 401) {
                        $.iaoAlert({
                            msg: '@(Resources.ErrorMessage.UnAuthorizedErrorMessage)',
                            type: "error",
                            mode: "dark",
                        });
                    }
                    else {
                        $.iaoAlert({
                            msg: '@(Resources.ErrorMessage.TechincalErrorMessage)',
                            type: "error",
                            mode: "dark",
                        });
                    }
                }
            });
        }

    }

    ////// -----------    FIELD VALIDATION HANDLER FUNCTIONS  --------------------------

    const validate_IsEmptyStringInputFieldValue = function (inputFieldValue) {
        if (inputFieldValue == '' || inputFieldValue.replace(/\s/g, "") == "")
            return true;
        return false;
    }

    const validate_IsEmptySelectInputFieldValue = function (inputFieldValue) {
        if (inputFieldValue == undefined || inputFieldValue == null || inputFieldValue == '' || inputFieldValue == 0)
            return true;
        return false;
    }
</script>

