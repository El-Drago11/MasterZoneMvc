<script>
    var StaffId_Global = 0;
    var UserToken_Global = "";

    $(document).ready(function () {
        $.get("/Business/GetBusinessAdminToken", null, function (dataToken) {
            if (dataToken != "" && dataToken != null) {
                UserToken_Global = dataToken;
                GetAllStaffAttendanceList();
                //StopLoading();
            }
            else {
                $.get("/Business/GetStaffToken", null, function (dataToken) {
                    if (dataToken != "" && dataToken != null) {
                        UserToken_Global = dataToken;
                        //GetAllStaff();
                        GetAllStaffAttendanceList();
                        //StopLoading();
                    }
                    else {
                        StopLoading();
                    }
                });
            }
        });

        $("#btnAddStaffAttendance").click(function () {
            GetAllStaff();
            //UpdateStaffAttendance();
            $("#SectionAddStaffAttendance").show();
            $("#SetionViewStaffAttendance").hide();
            $("#btnAddStaffAttendance").hide();

        });
    });

      function SearchAttendanceListByDate() {


      var _searchDate_val = String($("#SearchDate_Attendance").val());


      $.ajax({
          type: "GET",
          url: '/api/Staff/GetAll/GetAllStaffAttendanceListByDate?searchDate='+_searchDate_val,
          headers: {
              "Authorization": "Bearer " + UserToken_Global,
              "Content-Type": "application/json"
          },
          contentType: 'application/json',
          success: function (response) {
              if (response.status < 1) {
                  $.iaoAlert({
                      msg: response.message,
                      type: "error",
                      mode: "dark",
                  });
                  return;
              }
              var today = new Date();
              var day = today.getDate();
              var month = today.getMonth() + 1;
              var year = today.getFullYear();

              // Format the date as desired
              var formattedDate = month + '/' + day + '/' + year;
              $("#SatffAttendanceTodayDate").html(formattedDate);
              var _table = $("#tblStaffAttendance").DataTable();
              _table.destroy();

              var sno = 0;

              var _staffImage = '';
              var _isApproved = '';
              var data = [];
              for (var i = 0; i < response.data.length; i++) {
                  var _status = '';
                  var _leaveReason = '';

                  sno++;
                  _staffImage = (response.data[i].StaffProfileImageWithPath == "") ? '' : '<a href="/Business/StaffDetail?staffLoginId=' + response.data[i].UserLoginId +'" > <img src="' + response.data[i].StaffProfileImageWithPath + '" class="image" /></a>';
                  //---Check Attendance-Status
                  //if (response.data[i].AttendanceStatus == 1 && response.data[i].StaffAttendanceInTime_24HF && response.data[i].StaffAttendnaceOutTime_24HF) {
                  //    _status = '<p  style="font-weight: 600;text-align: center">Not Set</p>';
                  //}
                   if (response.data[i].AttendanceStatus == 1) {
                       _status = '<p  style="color: green;font-weight: 600;text-align: center">Present</p>'
                           + '<div class="TimingsDetails mt-2" style="text-align:center">'
                           + '<span> In: ' + response.data[i].StaffAttendanceInTime_24HF + '</span><br>'
                           + '<span> Out: ' + response.data[i].StaffAttendnaceOutTime_24HF + '</span>'
                           + '</div>';
                  }
                  else if (response.data[i].AttendanceStatus == 2) {
                       _status = '<p  style="color: red;font-weight: 600;text-align: center">Absent</p>'
                           + '<div class="TimingsDetails" style="text-align:center">'
                           + '<span>' + response.data[i].AttendanceDate + '</span><br>'
                           + '</div>'; 
                  }
                  else if (response.data[i].AttendanceStatus == 3) {
                       _status = '<p  style="color: red;font-weight: 600;text-align: center">On Leave</p>'
                           + '<div class="TimingsDetails" style="text-align:center">'
                           + '<span>' + response.data[i].AttendanceDate + '</span><br>'
                           + '</div>'; 
                      if (response.data[i].IsApproved == 1) {
                          _isApproved = '<p  style="color: green;font-weight: 600;">Approved</p>';
                      }
                      else {
                          _isApproved = '<p  style="color: red;font-weight: 600;">Un-Approved</p>';
                      }
                      _leaveReason = `<p>${_isApproved}</p><p>${response.data[i].LeaveReason}</p>`;
                  }

                  data.push([
                      sno,
                      response.data[i].MasterId,
                      _staffImage,
                      response.data[i].StaffName + '<br>' + response.data[i].StaffCategoryName,
                      //response.data[i].AttendanceDate,
                      _status,
                      _leaveReason

                  ]);
              }

              $("#tblStaffAttendance").DataTable({
                  "data": data,
                  "paging": true,
                  "lengthChange": true,
                  "searching": true,
                  "ordering": true,
                  "info": true,
                  "autoWidth": false,
                  "responsive": true,
              });
              StopLoading();

          },
          error: function (result) {
              StopLoading();

              if (result["status"] == 401) {
                  $.iaoAlert({
                      msg: '@(Resources.ErrorMessage.UnAuthorizedErrorMessage)',
                      type: "error",
                      mode: "dark",
                  });
              }
              else {
                  $.iaoAlert({
                      msg: '@(Resources.ErrorMessage.TechincalErrorMessage)',
                      type: "error",
                      mode: "dark",
                  });
              }
          }
      });
  }

  function GetAllStaff()
  {

        var _url = "/api/Staff/GetAll";

        $.ajax({
            type: "GET",
            url: _url,
            headers: {
                "Authorization": "Bearer " + UserToken_Global,
                "Content-Type": "application/json"
            },
            contentType: 'application/json',
            success: function (response) {
                if (response.status < 1) {
                    $.iaoAlert({
                        msg: response.message,
                        type: "error",
                        mode: "dark",
                    });
                    return;
                }
                if (response.data.length <= 0) {
                    $("#StaffList").append('<div class="w-100 text-muted font-italic p-4 text-center ">No Staff!</div >');
                }
                var _table = $("#StaffList").DataTable();
                _table.destroy();
                var sno = 0;
                var staffId='';
                var staffName='';
                var AttendenceStatus='';
                var Timing='';
                var leaveReason='';
                var status='';
                var data = [];
                var staffList = '';
                for (var i = 0; i < response.data.length; i++) {

                    var item = response.data[i];
                    var StaffName = item.FirstName + item.LastName;

                    sno++;
                    staffId = '<td >'+item.MasterId+'</td>';
                    staffName = '<td class="text-center"><span class="staff-profile-img"><img src="' + item.ProfileImageWithPath + '" class="ImageAttendance" /><br> <label for="Name" value="' + item.Id + '" style="margin-top:8px;">' + StaffName + '</label><br> <label for="StaffCategoryName" value="' + item.Id + '" style="margin-top:-12px;">' + item.StaffCategoryName + '</label></span></td>';
                    AttendenceStatus = '<label>Attendance Status</label><br><select class="Staff_Attendance_Status form-control" name="staffAttendancestatus[]" data-staff-id=' + item.Id + ' id="SelectValSatffAttendanceStatus_' + item.Id + '" onChange="SelectSatffAttendanceStatus(' + item.Id + ');"><option value="0">Select Status</option><option value="1">Present</option><option value="2">Absent</option><option value="3">On Leave</option></select ><button type="button" class="btn btn-primary mb-0 mt-2" id="AbsentStatusBtn_' + item.Id + '" onClick="btnInOutStaffAttendance(' + item.Id + ')" style="display:none;">SAVE</button><div id="AttendanceTimingSection_' + item.Id + 'class="d-flex"><div class="error-class" id="error_SelectAttendanceStatus_' + item.Id + '"></div>';
                    Timing = '<div class="row"> <div class="col-sm-6"><label>In Time </label><br><div class="time-iner"> <input type="time" name="in-time" id="StaffAttendanceInTime_' + item.Id + '" disabled><a class="btn btn-primary btn-sm btn-out-time" id="staffInTime_' + item.Id + '" onClick="inTimeSubmit(' + item.Id + ')"> IN</a > </div > <div class="error-class" id="error_StaffAttendanceInTime_' + item.Id + '"></div></div > <div class="col-sm-6"><label>Out Time </label><br><div class="time-iner"><input type="time" name="out-time" id="StaffAttendanceOutTime_'+item.Id+'" disabled><a class="btn btn-primary btn-sm btn-out-time" id="staffOutTime_' + item.Id + '" onClick="outTimeSubmit(' + item.Id + ')">Out</a></div><div class="error-class" id="error_StaffAttendanceOutTime_' + item.Id + '"></div> </div></div ><div class="from-group mr-3"></div><div class="from-group"></div></div > ';
                    leaveReason = '<div id="LeaveReasonSection_' + item.Id + '" class="" style="display:none;"><span style = "margin-left:21px;"><input type="checkbox" class="form-check-input" id="chkIsApproved_' + item.Id + '"><label class="form-check-label" for="chkIsActive" style="cursor:pointer;">Is Approved</label></span><input type="text" id="LeaveReason_' + item.Id + '" class="form-control" placeholder="Please Enter Reason...." /><button type="button" class="btn btn-primary mb-0 mt-2" id="ChangeUpdateText" onClick="btnInOutStaffAttendance('+item.Id+')">SAVE</button><div class="error-class" id="error_txtLeaveReason_'+item.Id+'"></div>';
                    status = '<a class="not-set staff-status" id="staff-status_'+item.Id+'">No set</a>';

                    data.push([
                        /*sno,*/
                        staffId,
                        staffName,
                        AttendenceStatus,
                        Timing,
                        leaveReason,
                        status

                    ]);



                }
                $("#StaffList").DataTable({
                    "data": data,
                    "paging": true,
                    "lengthChange": true,
                    "searching": true,
                    "ordering": true,
                    "info": true,
                    "autoWidth": false,
                    "responsive": true,
                });
                UpdateStaffAttendance();

                StopLoading();
            },
            error: function (result) {
                StopLoading();

                if (result["status"] == 401) {
                    $.iaoAlert({
                        msg: '@(Resources.ErrorMessage.UnAuthorizedErrorMessage)',
                        type: "error",
                        mode: "dark",
                    });
                }
                else {
                    $.iaoAlert({
                        msg: '@(Resources.ErrorMessage.TechincalErrorMessage)',
                        type: "error",
                        mode: "dark",
                    });
                }
            }
        });
    }

   

    function SelectSatffAttendanceStatus(id) {
        var attendanceStatus = $("#SelectValSatffAttendanceStatus_" + id).val();
        if (attendanceStatus == 3) {
            $("#LeaveReasonSection_" + id).show();
            $("#StaffAttendanceInTime_" + id).attr('disabled', true).val('');
            $("#StaffAttendanceOutTime_" + id).attr('disabled', true).val('');
            $('#staffInTime_' + id).removeClass('btn-in-time')
            $('#staffInTime_' + id).addClass('btn-out-time ')
            $("#AbsentStatusBtn_" + id).hide();
        }
        else if (attendanceStatus == 1) {
            $("#StaffAttendanceInTime_" + id).attr('disabled', false);
            $("#StaffAttendanceOutTime_" + id).attr('disabled', true);
            $('#staffInTime_' + id).addClass('btn-in-time')
            $('#staffInTime_' + id).removeClass('btn-out-time ')
            $("#LeaveReasonSection_" + id).hide();
            $("#AbsentStatusBtn_" + id).hide();
        }
        else {
            $("#AbsentStatusBtn_" + id).show();
            $("#LeaveReasonSection_" + id).hide();
            $("#LeaveReason_" + id).val('');
            $("#StaffAttendanceInTime_" + id).attr('disabled', true).val('');
            $("#StaffAttendanceOutTime_" + id).attr('disabled', true).val('');
            $('#staffInTime_' + id).removeClass('btn-in-time')
            $('#staffInTime_' + id).addClass('btn-out-time ')

        }
    }


   function btnAddStaffAttendance() {

     var attendancelist = [];
     var Is_Valid = true;
     var total = 0;
     $('select[name="staffAttendancestatus[]"]').each(function () {
         if ($(this).val() > 0) {
             total++;
         }

     });
     if (total <= 0) {
         Is_Valid = false;
         $("#error_SelectAttendanceStatus_").append('@(Resources.BusinessPanel.AttendanceSelectStatusErrorMessage)');
     }

     $('.error-class').html('');

     $(".Staff_Attendance_Status").each(function () {
         var staffId = $(this).attr('data-staff-id');
         var attendance_Status = $(this).val();
         var leave_Reason = $("#LeaveReason_" + staffId).val();
         var selectAttendanceStatus = $("#SelectValSatffAttendanceStatus_" + staffId).val();
         var staffAttendanceInTime_24HF = $("#StaffAttendanceInTime_" + staffId).val();
         var staffAttendanceOutTime_24HF = $("#StaffAttendanceOutTime_" + staffId).val();
         if (attendance_Status == 3) {
             if (leave_Reason == "") {
                 Is_Valid = false;
                 $("#error_txtLeaveReason_" + staffId).html('@(Resources.BusinessPanel.ErrorMessageLeaveReason)');
             }
             var _isApproved = 0;
             if ($("#chkIsApproved_" + staffId).is(':checked')) {
                 // checked
                 _isApproved = 1;
             }
         }
         if (attendance_Status == 1)
         {
             if (staffAttendanceInTime_24HF == "")
             {
                 Is_Valid = false;
                 $("#error_StaffAttendanceInTime_" + staffId).html('@(Resources.BusinessPanel.ErrorMessageAttendanceTimeIn)');
             }
             if (staffAttendanceOutTime_24HF != "")
             {
                 if (staffAttendanceInTime_24HF >= staffAttendanceOutTime_24HF)
                 {
                     Is_Valid = false;
                     $("#error_StaffAttendanceOutTime_" + staffId).html('@(Resources.BusinessPanel.AttendanceOuTimeErrorMessage)')

                 }
             }
         }

         attendancelist.push({
             staffId: staffId,
             attendanceStatus: attendance_Status,
             leaveReason: leave_Reason,
             isApproved: _isApproved,
             staffAttendanceInTime24HF: staffAttendanceInTime_24HF,
             staffAttendanceOutTime24HF:staffAttendanceOutTime_24HF
         });
     });


     if (Is_Valid) {
         $.ajax({
             url: '/api/Staff/AddUpdate/StaffAttendance',
             headers: {
                 "Authorization": "Bearer " + UserToken_Global
             },
             data: JSON.stringify(attendancelist),
             contentType: 'application/json', // Set the content type to JSON
             type: 'POST',
             success: function (dataResponse) {
                 //--If successfully added/updated
                 if (dataResponse.status === 1) {
                     swal("Success!", dataResponse.message, "success");
                     ResetAddStaffAttendanceView();
                     GetAllStaffAttendanceList();

                 } else {
                     swal({
                         title: 'Error!',
                         icon: 'error',
                         text: dataResponse.message
                     });
                     StopLoading();
                     return;
                 }

                 //StopLoading();
             },
             error: function (result) {
                 StopLoading();
                 if (result["status"] == 401) {
                     $.iaoAlert({
                         msg: '@(Resources.ErrorMessage.UnAuthorizedErrorMessage)',
                         type: "error",
                         mode: "dark",
                     });
                 } else {
                     $.iaoAlert({
                         msg: '@(Resources.ErrorMessage.TechincalErrorMessage)',
                         type: "error",
                         mode: "dark",
                     });
                 }
             }
         });
     }
 }


    function GetAllStaffAttendanceList() {
        var _url = "/api/Staff/GetAllDetails/StaffAttendance";

    $.ajax({
        type: "GET",
        url: _url,
        headers: {
            "Authorization": "Bearer " + UserToken_Global,
            "Content-Type": "application/json"
        },
        contentType: 'application/json',
        success: function (response) {
            if (response.status < 1) {
                $.iaoAlert({
                    msg: response.message,
                    type: "error",
                    mode: "dark",
                });
                return;
            }
            var today = new Date();
            var day = today.getDate();
            var month = today.getMonth() + 1;
            var year = today.getFullYear();

            // Format the date as desired
            var formattedDate = month + '/' + day + '/' + year;
            $("#SatffAttendanceTodayDate").html(formattedDate);
            var _table = $("#tblStaffAttendance").DataTable();
            _table.destroy();

            var sno = 0;

            var _staffImage = '';
            var _isApproved = '';
            var data = [];
            for (var i = 0; i < response.data.length; i++) {
                var _leaveReason = '';
                var _status = '';
                sno++;
                _staffImage = (response.data[i].StaffProfileImageWithPath == "") ? '' : '<a href="/Business/StaffDetail?staffLoginId=' + response.data[i].UserLoginId +'"><img src="' + response.data[i].StaffProfileImageWithPath + '" class="image" /></a>';
                //---Check Attendance-Status
                if (response.data[i].AttendanceStatus == 1) {
                    _status = '<p  style="color: green;font-weight: 600;text-align: center">Present</p>'
                        + '<div class="TimingsDetails mt-2" style="text-align:center">'
                        + '<span> In: ' + response.data[i].StaffAttendanceInTime_24HF + '</span><br>'
                        + '<span> Out: ' + response.data[i].StaffAttendnaceOutTime_24HF + '</span>'
                        +'</div>';
                }
                else if (response.data[i].AttendanceStatus == 2) {
                    _status = '<p  style="color: red;font-weight: 600;text-align: center">Absent</p>'
                        + '<div class="TimingsDetails" style="text-align:center">'
                        + '<span>' + response.data[i].AttendanceDate + '</span><br>'
                        + '</div>'; 
                }
                else if (response.data[i].AttendanceStatus == 3) {
                    _status = '<p  style="color: red;font-weight: 600;text-align: center">On Leave</p>'
                        + '<div class="TimingsDetails" style="text-align:center">'
                        + '<span>' + response.data[i].AttendanceDate + '</span><br>'
                        + '</div>'    ;
                    if (response.data[i].IsApproved == 1) {
                        _isApproved = '<p  style="color: green;font-weight: 600;">Approved</p>';
                    }
                    else {
                        _isApproved = '<p  style="color: red;font-weight: 600;">Un-Approved</p>';
                    }
                    _leaveReason = `<p>${_isApproved}</p><p>${response.data[i].LeaveReason}</p>`;
                }
                data.push([
                    sno,
                    response.data[i].MasterId,
                    _staffImage,
                    response.data[i].StaffName + '<br>' + response.data[i].StaffCategoryName,
                    //response.data[i].AttendanceDate,
                    _status,
                    _leaveReason

                ]);
            }

            $("#tblStaffAttendance").DataTable({
                "data": data,
                "paging": true,
                "lengthChange": true,
                "searching": true,
                "ordering": true,
                "info": true,
                "autoWidth": false,
                "responsive": true,
            });
            StopLoading();
        },
        error: function (result) {
            StopLoading();

            if (result["status"] == 401) {
                $.iaoAlert({
                    msg: '@(Resources.ErrorMessage.UnAuthorizedErrorMessage)',
                    type: "error",
                    mode: "dark",
                });
            }
            else {
                $.iaoAlert({
                    msg: '@(Resources.ErrorMessage.TechincalErrorMessage)',
                    type: "error",
                    mode: "dark",
                });
            }
        }
    });
    }

    function ResetAddStaffAttendanceView() {
        $("#SectionAddStaffAttendance").hide();
        $("#SetionViewStaffAttendance").show();
        $("#btnAddStaffAttendance").show();
        $("#StaffList").html('');
    }
    function UpdateStaffAttendance() {
        var _url = "/api/Staff/GetAll/StaffAttendance";
          $.ajax({
            type: "GET",
            url: _url,
            headers: {
                "Authorization": "Bearer " + UserToken_Global,
                "Content-Type": "application/json"
            },
            contentType: 'application/json',
            success: function (response) {
                if (response.status < 1) {
                    $.iaoAlert({
                        msg: response.message,
                        type: "error",
                        mode: "dark",
                    });
                    return;
                }
                //if (response.data.length <= 0) {
                //    GetAllStaff();
                //}

                for (var i = 0; i < response.data.length; i++) {
                    var item = response.data[i];

                    $("#SelectValSatffAttendanceStatus_" + item.StaffId).val(item.AttendanceStatus);
                    if (item.AttendanceStatus == 1) {
                        //If user already have logged Out once
                        if (item.StaffAttendanceInTime_24HF && item.StaffAttendnaceOutTime_24HF) {
                            $("#StaffAttendanceInTime_" + item.StaffId).attr('disabled', true).val("");
                            $("#StaffAttendanceOutTime_" + item.StaffId).attr('disabled', true).val("");
                            $("#SelectValSatffAttendanceStatus_" + item.StaffId).val(0);
                        } else {
                            if (!item.StaffAttendanceInTime_24HF || item.StaffAttendanceInTime_24HF == "") {
                                $("#StaffAttendanceInTime_" + item.StaffId).attr('disabled', false).val(item.StaffAttendanceInTime_24HF);
                                $('#staffInTime_' + item.StaffId).removeClass('btn-out-time')
                                $('#staffInTime_' + item.StaffId).addClass('btn-in-time')
                            } else {
                                $("#StaffAttendanceInTime_" + item.StaffId).attr('disabled', true).val(item.StaffAttendanceInTime_24HF);
                                $('#staffInTime_' + item.StaffId).addClass('btn-out-time')
                                $('#staffInTime_' + item.StaffId).removeClass('btn-in-time')
                                $('#SelectValSatffAttendanceStatus_' + item.StaffId).attr('disabled', true)
                                var element = document.getElementById('staffInTime_' + item.StaffId)
                                element.setAttribute('disabled', 'disabled')
                                element.onclick = null;
                            }
                            //Check if the staff is TimeOut
                            if (!item.StaffAttendnaceOutTime_24HF || item.StaffAttendnaceOutTime_24HF == "") {
                                $("#StaffAttendanceOutTime_" + item.StaffId).attr('disabled', false).val(item.StaffAttendnaceOutTime_24HF);
                                $('#staffOutTime_' + item.StaffId).removeClass('btn-out-time')
                                $('#staffOutTime_' + item.StaffId).addClass('btn-in-time')
                            } else {
                                $("#StaffAttendanceOutTime_" + item.StaffId).attr('disabled', true).val(item.StaffAttendnaceOutTime_24HF);
                                $('#staffOutTime_' + item.StaffId).addClass('btn-out-time')
                                $('#staffOutTime_' + item.StaffId).removeClass('btn-in-time')
                                var element = document.getElementById('staffOutTime_' + item.StaffId)
                                element.setAttribute('disabled', 'disabled')
                                element.onclick = null;
                            }

                            $('#staff-status_' + item.StaffId).removeClass('not-set')
                            $('#staff-status_' + item.StaffId).removeClass('Absent')
                            $('#staff-status_' + item.StaffId).removeClass('on-leave')
                            $('#staff-status_' + item.StaffId).addClass('Present-cta').html('Present')
                        }

                    }
                    else if (item.AttendanceStatus == 3) {
                        $("#LeaveReasonSection_" + item.StaffId).show();
                        $("#LeaveReason_" + item.StaffId).val(item.LeaveReason);
                        $("#StaffAttendanceInTime_" + item.StaffId).attr('disabled', true).val('');
                        $("#StaffAttendanceOutTime_" + item.StaffId).attr('disabled', true).val('');
                        $('#staff-status_' + item.StaffId).removeClass('not-set')
                        $('#staff-status_' + item.StaffId).removeClass('Present-cta')
                        $('#staff-status_' + item.StaffId).removeClass('Absent')
                        $('#staff-status_' + item.StaffId).addClass('on-leave').html('On-leave')
                        $('#staffInTime_' + item.StaffId).removeClass('btn-in-time')
                        $('#staffInTime_' + item.StaffId).addClass('btn-out-time ')

                        if (item.IsApproved == 1) {
                            $("#chkIsApproved_" + item.StaffId).prop('checked', true);
                        }
                        else {
                            $("#chkIsApproved_" + item.StaffId).prop('checked', false);
                        }
                    }
                    else if (item.AttendanceStatus == 2) {
                        $("#StaffAttendanceInTime_" + item.StaffId).attr('disabled', true).val('');
                        $("#StaffAttendanceOutTime_" + item.StaffId).attr('disabled', true).val('');
                        $('#staff-status_' + item.StaffId).removeClass('not-set')
                        $('#staff-status_' + item.StaffId).removeClass('Present-cta')
                        $('#staff-status_' + item.StaffId).removeClass('on-leave')
                        $('#staff-status_' + item.StaffId).addClass('Absent').html('Absent')
                        $('#staffInTime_' + item.StaffId).removeClass('btn-in-time')
                        $('#staffInTime_' + item.StaffId).addClass('btn-out-time ')

                        if (item.IsApproved == 1) {
                            $("#chkIsApproved_" + item.StaffId).prop('checked', true);
                        }
                        else {
                            $("#chkIsApproved_" + item.StaffId).prop('checked', false);
                        }
                    }
                    else
                    {
                        $("#StaffAttendanceInTime_" + item.StaffId).attr('disabled', true).val('');
                        $("#StaffAttendanceOutTime_" + item.StaffId).attr('disabled', true).val('');
                        $("#LeaveReasonSection_" + item.StaffId).hide();
                        $('#staff-status_' + item.StaffId).removeClass('Absent')
                        $('#staff-status_' + item.StaffId).removeClass('Present-cta')
                        $('#staff-status_' + item.StaffId).removeClass('on-leave')
                        $('#staff-status_' + item.StaffId).addClass('not-set').html('Not-set')
                    }
                }


                StopLoading();
            },
            error: function (result) {
                StopLoading();

                if (result["status"] == 401) {
                    $.iaoAlert({
                        msg: '@(Resources.ErrorMessage.UnAuthorizedErrorMessage)',
                        type: "error",
                        mode: "dark",
                    });
                }
                else {
                    $.iaoAlert({
                        msg: '@(Resources.ErrorMessage.TechincalErrorMessage)',
                        type: "error",
                        mode: "dark",
                    });
                }
            }
        });
    }

    //New feature IN/OUT

    function inTimeSubmit(staffId) {
        var inTime = $("#StaffAttendanceInTime_" + staffId).val();
        if (!inTime) {
            return;
        }
        document.getElementById('StaffAttendanceInTime_' + staffId).disabled = true;
        $('#staffInTime_' + staffId).removeClass('btn-in-time')
        $('#staffInTime_' + staffId).addClass('btn-out-time ')
        $('#staffOutTime_' + staffId).removeClass('btn-out-time ')
        $('#staffOutTime_' + staffId).addClass('btn-in-time')
        document.getElementById('StaffAttendanceOutTime_' + staffId).disabled = false;
        btnInOutStaffAttendance(staffId);
    }
    function outTimeSubmit(staffId) {
        var inTime = $("#StaffAttendanceOutTime_" + staffId).val();
        if (!inTime) {
            return;
        }
        document.getElementById('StaffAttendanceOutTime_' + staffId).disabled = true;
        $('#staffOutTime_' + staffId).removeClass('btn-in-time')
        $('#staffOutTime_' + staffId).addClass('btn-out-time ')
        btnInOutStaffAttendance(staffId);
    }


    function btnInOutStaffAttendance(staffId) {

        var attendancelist = [];
        var Is_Valid = true;

        $('.error-class').html('');
            var attendance_Status = $("#SelectValSatffAttendanceStatus_" + staffId).val();
            var leave_Reason = $("#LeaveReason_" + staffId).val();
            var selectAttendanceStatus = $("#SelectValSatffAttendanceStatus_" + staffId).val();
            var staffAttendanceInTime_24HF = $("#StaffAttendanceInTime_" + staffId).val();
            var staffAttendanceOutTime_24HF = $("#StaffAttendanceOutTime_" + staffId).val();
            var _isApproved = 0;
            if (attendance_Status == 1)
            {
                if (staffAttendanceInTime_24HF == "")
                {
                    Is_Valid = false;
                    $("#error_StaffAttendanceInTime_" + staffId).html('@(Resources.BusinessPanel.ErrorMessageAttendanceTimeIn)');
                    $('#staffOutTime_' + staffId).addClass('btn-in-time')
                    $('#staffOutTime_' + staffId).removeClass('btn-out-time ')
                }
                if (staffAttendanceOutTime_24HF != "")
                {
                    if (staffAttendanceInTime_24HF >= staffAttendanceOutTime_24HF)
                    {
                        document.getElementById('StaffAttendanceOutTime_' + staffId).disabled = false;
                        $('#staffOutTime_' + staffId).addClass('btn-in-time')
                        $('#staffOutTime_' + staffId).removeClass('btn-out-time ')
                        Is_Valid = false;
                        $("#error_StaffAttendanceOutTime_" + staffId).html('@(Resources.BusinessPanel.AttendanceOuTimeErrorMessage)')
                       

                    }
                }
                leave_Reason = "";
            } else if (attendance_Status == 3) {
                if (!$("#chkIsApproved_" + staffId).prop('checked')) {
                    return;
                } else {
                    _isApproved = 1;
                }
            } else if (attendance_Status == 2) {

            }
            else {
                
                return;
            }

            attendancelist.push({
                staffId: staffId,
                attendanceStatus: attendance_Status,
                leaveReason: leave_Reason,
                isApproved: _isApproved,
                staffAttendanceInTime24HF: staffAttendanceInTime_24HF,
                staffAttendanceOutTime24HF: staffAttendanceOutTime_24HF,
            });


        if (Is_Valid) {
            /*console.log(JSON.stringify(attendancelist));*/
            $.ajax({
                url: '/api/Staff/InOut/StaffAttendance',
                headers: {
                    "Authorization": "Bearer " + UserToken_Global
                },
                data: JSON.stringify(attendancelist),
                contentType: 'application/json', // Set the content type to JSON
                type: 'POST',
                success: function (dataResponse) {
                    //--If successfully added/updated
                    if (dataResponse.status === 1) {
                        swal("Success!", dataResponse.message, "success");
                        ResetAddStaffAttendanceView();
                        GetAllStaffAttendanceList();

                    } else {
                        swal({
                            title: 'Error!',
                            icon: 'error',
                            text: dataResponse.message
                        });
                        StopLoading();
                        
                        return;
                    }

                    //StopLoading();
                    $("#btnAddStaffAttendance").trigger("click");
                },
                error: function (result) {
                    StopLoading();
                    if (result["status"] == 401) {
                        $.iaoAlert({
                            msg: '@(Resources.ErrorMessage.UnAuthorizedErrorMessage)',
                            type: "error",
                            mode: "dark",
                        });
                    } else {
                        $.iaoAlert({
                            msg: '@(Resources.ErrorMessage.TechincalErrorMessage)',
                            type: "error",
                            mode: "dark",
                        });
                    }
                }
            });
        } 
    }


</script>
