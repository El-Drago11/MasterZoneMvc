@using MasterZoneMvc.ViewModels;

@{
    var UserRole = Context.Items["UserRole"] as string;

    string ControllerNameForLinks = (UserRole == "BusinessAdmin") ? "Business" : "Staff";
    var Permissions = Context.Items["Permissions"] as List<PermissionHierarchy_VM>;
    List<PermissionHierarchy_VM> permissions = Permissions;
    List<string> permissionKeys = new List<string>();
    if (permissions.Count() > 0)
    {
        permissionKeys = permissions.Select(p => p.KeyName).ToList();
    }
}
<script>
    var UserToken_Global = "";


    function initializeDataTable_MasterProExtraInformationService() {
        _businessserviceTable = $("#ViewForMasterproExtraDetailsService").DataTable();
    }

    $(document).ready(function () {
        $.get("/Business/GetBusinessAdminToken", null, function (dataToken) {
            if (dataToken != "" && dataToken != null) {
                UserToken_Global = dataToken;

                initializeDataTable_MasterProExtraInformationService();
                GetAllMasterProExtraDetailsService();
                StopLoading();
            }
            else {
                $.get("/Business/GetStaffToken", null, function (dataToken) {
                    if (dataToken != "" && dataToken != null) {
                        UserToken_Global = dataToken;

                        initializeDataTable_MasterProExtraInformationService();

                        GetAllMasterProExtraDetailsService();
                        //StopLoading();
                    }
                    else {
                        StopLoading();
                    }
                });
            }
        });
    });


    function GetAllMasterProExtraDetailsService() {

    // ---------------- Pagination Data Table --------------------
        var _url_val = "/api/Business/GetAllMasterProExtraInformationServiceDataTablePagination";
    _businessserviceTable.clear().destroy();
    _businessserviceTable = $("#ViewForMasterproExtraDetailsService").DataTable({
        "processing": true,
        "serverSide": true,
        "filter": true,
        "orderMulti": false,
        "ordering": true,
        "paginate": true,
        "order": [[3, "desc"]],
        "ajax": {
            "headers": {
                "Authorization": "Bearer " + UserToken_Global
            },
            "url": _url_val,
            "type": "POST",
            //"data": { "_Params": JSON.stringify(_Params) },
            //"datatype": "json",
            "error": function (result) {
                if (result["status"] == 401) {
                    $.iaoAlert({
                        msg: '@Resources.ErrorMessage.UnAuthorizedErrorMessage',
                        type: "error",
                        mode: "dark",
                    });
                }
                else {
                    $.iaoAlert({
                        msg: '@Resources.ErrorMessage.TechincalErrorMessage',
                        type: "error",
                        mode: "dark",
                    });
                }
            }
        },
        "columns": [
            {
                "data": "SerialNumber", "name": "CreatedOn", "autoWidth": true
                //,"render": function (data, type, row) {
                //    return '';
                //}
            }
            , { "data": "Title", "name": "Title", "autoWidth": true }
            , { "data": "ShortDescription", "name": "ShortDescription", "autoWidth": true }



            , {
                "data": null, "": "action", "autowidth": true,
                "render": function (data, type, row) {

                    var _edit = '';
                    var _delete = '';


                    _edit = `<a href="javascript:EditMasterProExtraInformationServiceDetail(${row.Id});"><i class="fas fa-edit" title="Edit"></i></a>`;



                    _delete = `<a href="javascript:ConfirmDeletedMasterProExtraInformationService(${row.Id});"><i class="fas fa-trash" title="Delete"></i></a>`;


                    var _action = `<div class="edbt">


                                ${_edit}
                                ${_delete}
                            </div>`;
                    return _action;
                }
            }


        ],

        "responsive": true,
        "autoWidth": false,
        //"dom": "<'row my-3'<'col-sm-12'B>><'row'<'col-sm-6'l><'col-sm-6'f>><'row'<'col-sm-12'tr>><'row'<'col-sm-12 col-md-5'i><'col-sm-12 col-md-7'p>>",
        "columnDefs": [{
            "targets": [0,3], // column index (start from 0)
            "orderable": false, // set orderable false for selected columns
        }]
    });

    // for enabling search box only send request on pressing enter
    $('#ViewForBusinessService_filter input').unbind();
    $('#ViewForBusinessService_filter input').bind('keyup', function (e) {
        if (e.keyCode == 13 || (e.keyCode == 8 && $(this).val() == '')) {
            _businessserviceTable.search(this.value).draw();
        }
    });

    // ----------------  Pagination Data Table ------------------
    }

    $('#btnBusinessServiceAdds').click(function () {
        $("#BusinessServiceStatusInserted").addClass('d-none');
        $('#sectionAddBusinessServices').show();
        $('#sectionViewBusinessServices').hide();
        $('#btnBusinessServiceAdds').hide();
        document.getElementById("pageTextchanges").innerHTML = "Add MasterPro Extra Information Services";
        document.getElementById("pageStageChanges").innerHTML = "Add MasterPro Extra Information Services";

    });





    var BusinessServiceId_Global = 0;
    function btnSubmitToMasterProExtraInformationInfo() {

       let is_valid = true;
       $(".error-class").html('');
        var _mode = (BusinessServiceId_Global > 0) ? 2 : 1;

        let _masterProExtraInformationservicetitle = $("#Title_Name").val().trim();
        let _masterProExtraInformationservicedescription = $("#masterprosservice_description").val().trim();
        let _error_masterProExtraInformationservicetitle = $("#error_Title_Name");
        let _error_masterProExtraInformationservicedescription = $("#error_businessservice_description");

        if (validate_IsEmptyStringInputFieldValue(_masterProExtraInformationservicetitle)) {
            is_valid = false;
            _error_masterProExtraInformationservicetitle.html('@(Resources.BusinessPanel.MasterProExtraInfoServiceTitleRequired)');

        }

        if (validate_IsEmptyStringInputFieldValue(_masterProExtraInformationservicedescription))
        {
             is_valid = false;
            _error_masterProExtraInformationservicedescription.html('@(Resources.BusinessPanel.MasterProExtraInfoServiceDescription)');
        }


        
        if (is_valid) {
            var data = new FormData();

            data.append("Id", BusinessServiceId_Global);
            data.append("Title", _masterProExtraInformationservicetitle);
            data.append("Description", _masterProExtraInformationservicedescription);
            data.append('Mode', _mode);

           
            $.ajax({
                url: '/api/Business/AddUpdateMasterproExtraInformation',
                headers: {
                    "Authorization": "Bearer " + UserToken_Global,

                },
                data: data,
                processData: false,
                mimeType: 'multipart/form-data',
                contentType: false,
                //contentType: 'application/json',
                type: 'POST',
                success: function (dataResponse) {

                    //--Parse into Json of response-json-string
                    dataResponse = JSON.parse(dataResponse);

                    //--If successfully added/updated
                    if (dataResponse.status === 1)
                    {
                        swal("Success!", dataResponse.message, "success");
                        ResetAddView();
                        GetAllMasterProExtraDetailsService();
                    }
                    else
                    {
                        swal({
                            title: 'Error!',
                            icon: 'error',
                            text: dataResponse.message
                        });
                        StopLoading();

                        return;
                    }

                    StopLoading();

                },
                error: function (result)
                {
                    //StopLoading();

                    if (result["status"] == 401)
                    {
                        $.iaoAlert({
                            msg: '@(Resources.ErrorMessage.UnAuthorizedErrorMessage)',
                            type: "error",
                            mode: "dark",
                        });
                    }
                    else {
                        $.iaoAlert({
                            msg: '@(Resources.ErrorMessage.TechincalErrorMessage)',
                            type: "error",
                            mode: "dark",
                        });
                    }
                }
            });
        }
    }


    function EditMasterProExtraInformationServiceDetail(Id) {

        $("#BusinessServiceStatusInserted").removeClass('d-none');
        $('#sectionAddBusinessServices').show();
        $('#sectionViewBusinessServices').hide();
        document.getElementById("myTexts").innerHTML = "Edit ";
        document.getElementById("ChangeUpdateTexts").innerHTML = "Update";
        document.getElementById("pageTextchanges").innerHTML = "Edit MasterPro Extra Information Servies";
        document.getElementById("pageStageChanges").innerHTML = "Edit MasterPro Extra Information Services";
        $('#ChangeUpdateTexts').show();
        $('#btnBusinessServiceAdds').hide();
        $(".error-class").html('');
        $('#btnBusinessServiceAdds').click(function () {
            document.getElementById("myTexts").innerHTML = "Add MasterPro Extra Details Services";
            document.getElementById("ChangeUpdateTexts").innerHTML = "Save";
            $(".error-class").html('');
        });

        var _url = "/api/Business/GetMasterProExtraInformationServiceDetailById?id=" + Id;

        StartLoading();

        $.ajax({
            type: "GET",
            url: _url,
            headers: {
                "Authorization": "Bearer " + UserToken_Global,
                "Content-Type": "application/json"
            },
            contentType: 'application/json',
            success: function (response) {
                if (response.status < 1) {
                    $.iaoAlert({
                        msg: response.message,
                        type: "error",
                        mode: "dark",
                    });
                    return;
                    /* getAllActiveStudentsLists();*/
                }
                BusinessServiceId_Global = response.data.Id;
                $("#Title_Name").val(response.data.Title);
                $("#masterprosservice_description").val(response.data.ShortDescription);




                StopLoading();
            },
            error: function (result) {
                StopLoading();

                if (result["status"] == 401) {
                    $.iaoAlert({
                        msg: '@(Resources.ErrorMessage.UnAuthorizedErrorMessage)',
                        type: "error",
                        mode: "dark",
                    });
                }
                else {
                    $.iaoAlert({
                        msg: '@(Resources.ErrorMessage.TechincalErrorMessage)',
                        type: "error",
                        mode: "dark",
                    });
                }
            }
        });
    }



     function DeletedMasterProExtraInformationServiceDetail(id) {
       StartLoading();
         $.ajax({
             type: "POST",
             url: "/api/Business/DeleteMasterProExtraDetailsServiceById?id=" + id,
             headers: {
                 "Authorization": "Bearer " + UserToken_Global,
                 "Content-Type": "application/json"
             },
             contentType: 'application/json',
             success: function (dataResponse) {
                 StopLoading();

                 //--Check if business service successfully deleted
                 if (dataResponse.status == 1) {
                     setTimeout(function () {
                         swal("Success!", dataResponse.message, "success");
                         GetAllMasterProExtraDetailsService();
                     }, 100);
                 }
                 else {
                     $.iaoAlert({
                         msg: '@(Resources.ErrorMessage.TechincalErrorMessage)',
                         type: "error",
                         mode: "dark",
                     });
                 }
             },
             error: function (result) {
                 StopLoading();

                 if (result["status"] == 401) {
                     $.iaoAlert({
                         msg: '@(Resources.ErrorMessage.UnAuthorizedErrorMessage)',
                         type: "error",
                         mode: "dark",
                     });
                 }
                 else {
                     $.iaoAlert({
                         msg: '@(Resources.ErrorMessage.TechincalErrorMessage)',
                         type: "error",
                         mode: "dark",
                     });
                 }
             }
         });
     }

    function ResetAddView() {
        $('#btnBusinessServiceAdds').show();
        $('#sectionAddBusinessServices').hide();
        $('#sectionViewBusinessServices').show();
        $('#Title_Name').val('');
        $('#masterprosservice_description').val('');
        $(".error-class").html('');
        BusinessServiceId_Global = 0;
        document.getElementById("pageTextchanges").innerHTML = "View Business Services";
        document.getElementById("pageStageChanges").innerHTML = "View Business Services";
    }

     function ConfirmDeletedMasterProExtraInformationService(id) {

     swal({
         title: "@(Resources.BusinessPanel.ConfirmDeletedMasterProMessageTitle)",
         text: "@(Resources.BusinessPanel.ConfirmDeletedMasterProMessage)",
         type: "warning",
         buttons: {
             cancel: true,
             confirm: "@(Resources.ErrorMessage.Yes)",
         }
     })
     .then((willDelete) => {
         if (willDelete) {
             DeletedMasterProExtraInformationServiceDetail(id);
         } else {
             //swal("Your imaginary file is safe!");
         }
     });
 }





     //document.getElementById('fileBusinessServiceImage').addEventListener('change', handleImageUpload);

@*function handleImageUpload(event) {
    const file = event.target.files[0];
    const fileSize = file.size / 1024; // size in kilobytes
    const maxSize = 10 * 1024 * 1024; // maximum size in kilobytes
    const fileType = file.type;
    const validFileTypes = ['application/pdf'];

   if (!validFileTypes.includes(fileType)) {
        $.iaoAlert({
            msg: '@(Resources.BusinessPanel.ValidFileTypesRequired)',
            type: "error",
            mode: "dark",
        });
       event.target.value = null; // clear the file input element
       $('#previewFile').addClass('d-none'); // hide the preview file
       return;
    }
    if (fileSize > maxSize) {
        $.iaoAlert({
            msg: '@(String.Format(Resources.BusinessPanel.FileSizeRequired, "10 MB"))',
            type: "error",
            mode: "dark",
        });
        event.target.value = null; // clear the file input element
        // $('#previewFile').addClass('d-none'); // hide the preview file
        return;
    }

    // image size is within the limit, display the preview image
    const reader = new FileReader();
    reader.onload = function (event) {
        document.getElementById('previewImage').src = event.target.result;
      //  $('#previewImage').removeClass('d-none');
    }

    reader.readAsDataURL(file);
}*@














    ////// -----------    FIELD VALIDATION HANDLER FUNCTIONS  --------------------------

    const validate_IsEmptyStringInputFieldValue = function (inputFieldValue) {
        if (inputFieldValue == '' || inputFieldValue.replace(/\s/g, "") == "")
            return true;
        return false;
    }

    const validate_IsEmptySelectInputFieldValue = function (inputFieldValue) {
        if (inputFieldValue == undefined || inputFieldValue == null || inputFieldValue == '' || inputFieldValue == 0)
            return true;
        return false;
    }





















</script>