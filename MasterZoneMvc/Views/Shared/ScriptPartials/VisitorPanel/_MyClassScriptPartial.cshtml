<script>
    var Class_LastRecordedId_Global = 0;
    var ActiveClass_LastRecordedId_Global = 0;
    var UserToken_Global = "";
    var recordLimit = 10;
    var ClassBookingIdGlobal = 0;
    var ClassEndDateGlobal = "";
    var ClassStartDateGlobal = "";

    $(document).ready(function () {

        $.get("/Home/GetStudentToken", null, function (dataToken) {
            if (dataToken != "" && dataToken != null) {
                UserToken_Global = dataToken;
                GetAllBusinessClasses();
                GetAllStudentActiveClasses();
                updatePauseDays();
               // GetAllStudentNEWActiveClasses();
            }
            else {
                /* UserToken_Global = "";*/
                StopLoading();
            }
        });

    });

    // Bind Business My  Expiry Classes
    function GetAllBusinessClasses() {

        $.ajax({
            type: "GET",
            url: '/api/Student/GetAllEndedCourse?lastRecordId=0',
            headers: {
                "Authorization": "Bearer " + UserToken_Global,
                "Content-Type": "application/json"
            },
            contentType: 'application/json',
            success: function (response) {
                if (response.status < 1) {
                    $.iaoAlert({
                        msg: response.message,
                        type: "error",
                        mode: "dark",
                    });
                    return;
                }
                $("#menuendclass").html('');
                var classList = '';

                if (response.data.length <= 0) {
                    // No data, show a message
                    $('#menuendclass').html('<div class="w-100 text-black-50 text-center mt-4"><i>You don\'t have any Classes!</i></div>');
                    $('#BtnViewMoreUpcomingClass').addClass('d-none');
                    StopLoading();
                    return;
                }

                for (var i = 0; i < response.data.length; i++) {
                    if (response.data.length < recordLimit) {
                        $("#BtnViewMoreUpcomingClass").addClass('btnViewMoreUpcomingEndClass');
                    } else {
                        $("#BtnViewMoreUpcomingClass").removeClass('d-none');
                    }

                    var starIcons = '';

                    if (response.data[i].AverageRating) {
                        rating = response.data[i].AverageRating;

                        for (var j = 1; j <= 5; j++) {
                            if (j <= rating) {
                                starIcons += '<i class="fa-solid fa-star rating-star-filled" style="color: #f3a762";></i>';
                            } else {
                                starIcons += `<i class="fa-solid fa-star rating-star-empty"></i>`;

                            }
                        }
                    }
                    else {
                        for (var j = 1; j <= 5; j++) {
                            starIcons += `<i class="fa-solid fa-star rating-star-empty"></i>`;
                        }
                    }

                  var classList = `
                                        <div class="my-cl-cnt-jdkfjk4-2">
                                <img class="img-cnt-jdk" src="${response.data[i].ClassImageWithPath}">
                                <div class="sd-cont-cnt-jdk">
                                    <p class="tm-cnt-jdk"> ${response.data[i].ScheduledStartOnTime_24HF} - ${response.data[i].ScheduledEndOnTime_24HF}</p>
                                    <h5 class="hd-cnt-jdk">${response.data[i].Name}</h5>
                                    <div class="hd-cnt-jdk text-muted">${response.data[i].StartDate} to ${response.data[i].EndDate}</div>
                                    <div class="hd-cnt-jdk text-muted">${response.data[i].ClassDays_ShortForm}</div>
                                    <p class="last-cntcnt-jdk">
                                        ${response.data[i].BusinessOwnerName} ${starIcons}
                                      ${response.data[i].AverageRating}<span class="tm-cnt-jdk ml-1">( ${response.data[i].TotalReviewsEntered})</span>
                                    </p>
                                    <p class="dtails-wdjri9">
                                        <span class="kjkjsdf"> ${response.data[i].ClassType} ${response.data[i].Description}</span>
                                    </p>
                                </div>
                            </div>

                                    `;

                        $("#menuendclass").append(classList);
                    }
                // Check if there is more data to load
                if (response.data.length > 0) {
                    Class_LastRecordedId_Global = response.data[response.data.length - 1].Id;
                    $('#BtnViewMoreUpcomingClass').removeClass('d-none');

                    //ViewMoreClassButton = `<div class="btn-outtrkjkd text-center mb-5 ">
                    //    <a  href= "javascript:ViewMoreUpcomingClasses();" id="BtnViewMoreUpcomingClass"
                    //       class="vmbtnjfdsklfj text-center mt-5 btn btn-outline-dark csbttnm">
                    //        View
                    //        More
                    //    </a>
                    //</div>`;
                    /*$("#menuendclass").append(ViewMoreClassButton);*/
                } else {
                    // No more data, hide the "View More" button
                    $('#BtnViewMoreUpcomingClass').addClass('d-none');
                }




                StopLoading();
            },
            error: function (result) {
                // StopLoading();

                if (result["status"] == 401) {
                    $.iaoAlert({
                        msg: 'Unauthorized! Invalid Token!',
                        type: "error",
                        mode: "dark",
                    });
                }
                else {
                    $.iaoAlert({
                        msg: 'There is some technical error, please try again!',
                        type: "error",
                        mode: "dark",
                    });
                }
            }
        });
    }

    // Bind Business LastRecord My Expiry Classes

    function ViewMoreUpcomingClasses() {

        $.ajax({
            type: "GET",
            url: '/api/Student/GetAllEndedCourse?lastRecordId=' + Class_LastRecordedId_Global,
            headers: {
                "Authorization": "Bearer " + UserToken_Global,
                "Content-Type": "application/json"
            },
            contentType: 'application/json',
            success: function (response) {
                if (response.status < 1) {
                    $.iaoAlert({
                        msg: response.message,
                        type: "error",
                        mode: "dark",
                    });
                    return;
                }
               // $("#menu1").html('');

                var classList = '';

                //if (response.data.length <= 0) {
                //    // No data, show a message
                //    $('#menu1').html('<div class="w-100 text-black-50 text-center mt-4"><i>You don\'t have any Classes!</i></div>');
                //    $('#BtnViewMoreUpcomingClass').addClass('d-none');
                //    StopLoading();
                //    return;
                //}
                for (var i = 0; i < response.data.length; i++) {

                    var classList = `
                                    <div class="my-cl-cnt-jdkfjk4-2">
                                <img class="img-cnt-jdk" src="${response.data[i].ClassImageWithPath}">
                                <div class="sd-cont-cnt-jdk">
                                    <p class="tm-cnt-jdk"> ${response.data[i].ScheduledStartOnTime_24HF} - ${response.data[i].ScheduledEndOnTime_24HF}</p>
                                    <h5 class="hd-cnt-jdk">${response.data[i].Name}</h5>
                                    <div class="hd-cnt-jdk text-muted">${response.data[i].StartDate} to ${response.data[i].EndDate}</div>
                                    <div class="hd-cnt-jdk text-muted">${response.data[i].ClassDays_ShortForm}</div>
                                    <p class="last-cntcnt-jdk">
                                        ${response.data[i].BusinessOwnerName} <i class="fa-solid fa-star"></i>
                                      ${response.data[i].AverageRating}<span class="tm-cnt-jdk ml-1">( ${response.data[i].TotalReviewsEntered})</span>
                                    </p>
                                    <p class="dtails-wdjri9">
                                        <span class="kjkjsdf"> ${response.data[i].ClassType} ${response.data[i].Description}</span>
                                    </p>
                                </div>
                            </div>


                                    `;

                    $("#menuendclass").append(classList);
                }
                // Check if there is more data to load
                if (response.data.length > 0) {
                    Class_LastRecordedId_Global = response.data[response.data.length - 1].Id;
                    $('#BtnViewMoreUpcomingClass').removeClass('d-none');

                //var ViewMoreClassButton = '';
                //ViewMoreClassButton = `<div class="btn-outtrkjkd text-center mb-5">
                //        <a  href= "javascript:ViewMoreUpcomingClasses();" id="BtnViewMoreUpcomingClass"
                //           class="vmbtnjfdsklfj text-center mt-5 btn btn-outline-dark csbttnm">
                //            View
                //            More
                //        </a>
                //    </div>`;
                //    $("#menuendclass").append(ViewMoreClassButton);

                } else {
                    // No more data, hide the "View More" button
                    $('#BtnViewMoreUpcomingClass').addClass('d-none');
                }



                StopLoading();
            },
            error: function (result) {
                // StopLoading();

                if (result["status"] == 401) {
                    $.iaoAlert({
                        msg: 'Unauthorized! Invalid Token!',
                        type: "error",
                        mode: "dark",
                    });
                }
                else {
                    $.iaoAlert({
                        msg: 'There is some technical error, please try again!',
                        type: "error",
                        mode: "dark",
                    });
                }
            }
        });
    }


    // Bind Business My  Expiry Classes
    //function GetAllStudentActiveClasses() {

    //    $.ajax({
    //        type: "GET",
    //        url: '/api/Student/GetAllActiveCourse?lastRecordId=0',
    //        headers: {
    //            "Authorization": "Bearer " + UserToken_Global,
    //            "Content-Type": "application/json"
    //        },
    //        contentType: 'application/json',
    //        success: function (response) {
    //            if (response.status < 1) {
    //                $.iaoAlert({
    //                    msg: response.message,
    //                    type: "error",
    //                    mode: "dark",
    //                });
    //                return;
    //            }
    //            var classList = '';

    //            $('#BindActiveClassDetail').html('');
    //            if (response.data.length <= 0) {
    //                // No data, show a message
    //                $('#BindActiveClassDetail').html('<div class="w-100 text-black-50 text-center mt-4"><i>You don\'t have any Active Classes!</i></div>');
    //                $('#BtnViewMoreUpcomingActiveClass').addClass('d-none');
    //                StopLoading();
    //                return;
    //            }
    //            for (var i = 0; i < response.data.length; i++) {
    //                if (response.data.length < recordLimit) {
    //                    $("#BtnViewMoreUpcomingActiveClass").addClass('btnViewMoreUpcomingClass');
    //                } else {
    //                    $("#BtnViewMoreUpcomingActiveClass").removeClass('d-none');
    //                }
    //                var starIcons = '';

    //                if (response.data[i].AverageRating) {
    //                    rating = response.data[i].AverageRating;

    //                    for (var j = 1; j <= 5; j++) {
    //                        if (j <= rating) {
    //                            starIcons += ' <i class="fa-solid fa-star rating-star-filled" style="color: #f3a762";></i>';
    //                        } else {
    //                            starIcons += `<i class="fa-solid fa-star rating-star-empty"></i>`;

    //                        }
    //                    }
    //                }
    //                else {
    //                    for (var j = 1; j <= 5; j++) {
    //                        starIcons += `<i class="fa-solid fa-star rating-star-empty"></i>`;
    //                    }
    //                }

    //                var PauseClassRequestbtn = '';
    //                //if (response.data[i].Status == 3 || response.data[i].Status == 0) {
    //                if (response.data[i].CanPauseClass == 1) {
    //                    PauseClassRequestbtn = `<div class="cta">
    //                            <a class="btn btn-dark primary-button" href="javascript:;" onclick="ClassModelRequestDetail('${response.data[i].Name}',${response.data[i].Id},'${response.data[i].EndDate}','${response.data[i].StartDate}')" style="text-decoration: none;">Pause Class</a>
    //                        </div>`;
    //                }
    //                else {
    //                    PauseClassRequestbtn = ``;
    //                }


    //                var classList = `
    //                                  <div class="my-cl-cnt-jdkfjk4-2">
    //                            <img class="img-cnt-jdk object-fit-contain" src="${response.data[i].ClassImageWithPath}">
    //                            <div class="sd-cont-cnt-jdk flex-grow-1">
    //                                <p class="tm-cnt-jdk"> ${response.data[i].ScheduledStartOnTime_24HF} - ${response.data[i].ScheduledEndOnTime_24HF}</p>
    //                                <h5 class="hd-cnt-jdk">${response.data[i].Name}</h5>
    //                                <div class="hd-cnt-jdk text-muted">${response.data[i].StartDate} to ${response.data[i].EndDate}</div>
    //                                <div class="hd-cnt-jdk text-muted">${response.data[i].ClassDays_ShortForm}</div>
    //                                <p class="last-cntcnt-jdk">
    //                                    ${response.data[i].BusinessOwnerName}${starIcons}
    //                                  ${response.data[i].AverageRating}<span class="tm-cnt-jdk ml-1">( ${response.data[i].TotalReviewsEntered})</span>
    //                                </p>
    //                                <p class="dtails-wdjri9">
    //                                    <span class="kjkjsdf"> ${response.data[i].ClassType} ${response.data[i].Description}</span>
    //                                </p>
    //                            </div>
    //                            ${PauseClassRequestbtn}
    //                        </div>


    //                                `;

    //                $("#BindActiveClassDetail").append(classList);
    //            }
    //            // Check if there is more data to load
    //            if (response.data.length > 0 ) {
    //                ActiveClass_LastRecordedId_Global = response.data[response.data.length - 1].Id;
    //                $('#BtnViewMoreUpcomingActiveClass').removeClass('d-none');
    //            } else {
    //                // No more data, hide the "View More" button
    //                $('#BtnViewMoreUpcomingActiveClass').addClass('d-none');
    //            }
    //            //var ViewMoreClassButton = '';
    //            //ViewMoreClassButton = `<div class="btn-outtrkjkd text-center mb-5 ${showingButton}">
    //            //        <a  href= "javascript:ViewMoreUpcomingActiveClasses();" id="BtnViewMoreUpcomingActiveClass"
    //            //           class="vmbtnjfdsklfj text-center mt-5 btn btn-outline-dark csbttnm">
    //            //            View
    //            //            More
    //            //        </a>
    //            //    </div>`;
    //            //$("#home").append(ViewMoreClassButton);





    //            StopLoading();
    //        },
    //        error: function (result) {
    //            // StopLoading();

    //            if (result["status"] == 401) {
    //                $.iaoAlert({
    //                    msg: 'Unauthorized! Invalid Token!',
    //                    type: "error",
    //                    mode: "dark",
    //                });
    //            }
    //            else {
    //                $.iaoAlert({
    //                    msg: 'There is some technical error, please try again!',
    //                    type: "error",
    //                    mode: "dark",
    //                });
    //            }
    //        }
    //    });
    //}

    // Bind Business LastRecord My Expiry Classes

    function ViewMoreUpcomingActiveClasses() {

        $.ajax({
            type: "GET",
            url: '/api/Student/GetAllActiveCourse?lastRecordId=' + ActiveClass_LastRecordedId_Global,
            headers: {
                "Authorization": "Bearer " + UserToken_Global,
                "Content-Type": "application/json"
            },
            contentType: 'application/json',
            success: function (response) {
                if (response.status < 1) {
                    $.iaoAlert({
                        msg: response.message,
                        type: "error",
                        mode: "dark",
                    });
                    return;
                }
                var classList = '';

                //if (response.data.length <= 0) {
                //    // No data, show a message
                //    $('#home').html('<div class="w-100 text-black-50 text-center mt-4"><i>You don\'t have any Classes!</i></div>');
                //    $('#BtnViewMoreUpcomingActiveClass').addClass('d-none');
                //    StopLoading();
                //    return;
                //}
                for (var i = 0; i < response.data.length; i++) {
                    if (response.data.length < recordLimit) {
                        $("#BtnViewMoreUpcomingActiveClass").addClass('btnViewMoreUpcomingClass');
                    } else {
                        $("#BtnViewMoreUpcomingActiveClass").removeClass('d-none');
                    }
                    var starIcons = '';

                    if (response.data[i].AverageRating) {
                        rating = response.data[i].AverageRating;

                        for (var j = 1; j <= 5; j++) {
                            if (j <= rating) {
                                starIcons += ' <i class="fa-solid fa-star rating-star-filled"></i>';
                            } else {
                                starIcons += `<i class="fa-solid fa-star rating-star-empty"></i>`;
                            }
                        }
                    }
                    else {
                        for (var j = 1; j <= 5; j++) {
                            starIcons += `<i class="fa-solid fa-star rating-star-empty"></i>`;
                        }
                    }

                    var PauseClassRequestbtn = '';
                    //if (response.data[i].Status == 3 || response.data[i].Status == 0) {
                    if (response.data[i].CanPauseClass == 1) {
                        PauseClassRequestbtn = `<div class="cta">
                            <a class="btn btn-dark primary-button" href="javascript:;" onclick="ClassModelRequestDetail('${response.data[i].Name}',${response.data[i].Id},'${response.data[i].EndDate}','${response.data[i].StartDate}')" style="text-decoration: none;">Pause Class</a>
                        </div>`;
                    }
                    else
                    {

                        PauseClassRequestbtn = ``;
                    }

                    var truncatedDescription = response.data[i].Description;
                    var maxLength = 100;
                    if (truncatedDescription.length > maxLength) {
                        truncatedDescription = truncatedDescription.substr(0, maxLength) + '...';
                    }
                    var classList = `<div class="active-class-main"><div class="active-class-tab">
                      <div class="active-class-tab-iner">
                          <div class="logo-img-iner">
                              <img src="${response.data[i].BusinessProfileImage}" alt="logo" loading="lazy">
                          </div>
                          <div class="text-title-start">
                              <div class="text-iner">
                                  <h6> ${response.data[i].BusinessName}</h6>

                              </div>
                              <div class="text-start">
                                 
                                  <span>
                                     ${starIcons}
                                  </span>

                              </div>
                          </div>
                      </div>
                      <div class="active-class-tab-iner">
                          <div class="guitar-img-iner">
                              <img src="${response.data[i].ImageWithPath}" alt="logo" loading="lazy">
                          </div>
                          <div class="text-title-start">
                              <div class="text-iner">
                                  <h6>${response.data[i].Name}</h6>
                                  <p>${response.data[i].Price}/${response.data[i].ClassPriceType}</p>
                              </div>
                              <div class="active-click-down">
                                  <div class="text-start">
                                      <a href="#">active</a>
                                  </div>
                                  <div class="arrow-down">
                                      <i class="fa-solid fa-angle-down"></i>
                                  </div>
                              </div>

                          </div>
                      </div>
                  </div>

                  <div class="active-class-item">
                      <div class="active-class-item-flex">
                          <div class="active-class-item-iner">
                              <div class="img-in-text-img">
                                  <img src="${response.data[i].GroupImageWithPath}" alt="img" loading="lazy">

                              </div>
                              <Div class="img-in-text-in">
                                  <p>${response.data[i].GroupName}</p>
                                  <p>
                                      <span>${response.data[i].ClassDays_ShortForm}</span>
                                      <span class="time-cl">${response.data[i].ScheduledStartOnTime_24HF} to ${response.data[i].ScheduledEndOnTime_24HF}</span>
                                  </p>

                              </Div>
                          </div>
                          <div class="active-class-item-iner second-child">

                              <div class="img-in-pro-img">
                                  <img src="${response.data[i].ProfileImageWithPath}" alt="img" loading="lazy">

                              </div>
                              <div class="img-in-text-in">
                                  <p class="profile-name">
                                      <span class="verified"><i class="fa-solid fa-circle-check"></i></span>
                                    ${response.data[i].BusinessOwnerName}
                                  </p>
                                  <p> ID ${response.data[i].MasterId}</p>
                                  <p>${response.data[i].BusinessCategoryName}</p>

                              </div>
                          </div>
                      </div>
                      <div class="button-iner">
                          <a href="/Home/MessageChat?toUserLoginId=${encodeURIComponent(response.data[i].EncryptedUserLoginId)}">Message</a>
                          <a href="#">
                              <span><i class="fa-solid fa-clipboard-user"></i></span>
                              Attendance
                          </a>
                          <a href="#">
                              <span><i class="fa-solid fa-file-invoice"></i></span>
                              Invoice
                          </a>
                      </div>
                      <div class="start-end-date-iner">
                          <div class="start-date">
                              <p>start Date</p>
                              <span class="date-style">${response.data[i].StartDate}</span>
                          </div>
                          <div class="start-date">
                              <p>Expire On</p>
                              <span class="Expire-style">${response.data[i].EndDate}</span>
                          </div>
                          <div class="date mt-4 ml-auto">
                         ${PauseClassRequestbtn}
                      </div>
                      </div>
                      <div class="des-text">
                          <p>
                              ${truncatedDescription}
                          </p>
                      </div>
                  </div></div>`;
                    $("#BindActiveClassDetail").append(classList);
                }





                // Check if there is more data to load
                if (response.data.length > 0) {
                    ActiveClass_LastRecordedId_Global = response.data[response.data.length - 1].Id;
                    $('#BtnViewMoreUpcomingActiveClass').removeClass('d-none');

                    //var ViewMoreClassButton = '';
                    //ViewMoreClassButton = `<div class="btn-outtrkjkd text-center mb-5">
                    //    <a  href= "javascript:ViewMoreUpcomingActiveClasses();" id="BtnViewMoreUpcomingActiveClass"
                    //       class="vmbtnjfdsklfj text-center mt-5 btn btn-outline-dark csbttnm">
                    //        View
                    //        More
                    //    </a>
                    //</div>`;
                    //$("#BindActiveClassDetail").append(ViewMoreClassButton);
                }

else {
                    // No more data, hide the "View More" button
                    $('#BtnViewMoreUpcomingActiveClass').addClass('d-none');
                }


                StopLoading();
            },
            error: function (result) {
                // StopLoading();

                if (result["status"] == 401) {
                    $.iaoAlert({
                        msg: 'Unauthorized! Invalid Token!',
                        type: "error",
                        mode: "dark",
                    });
                }
                else {
                    $.iaoAlert({
                        msg: 'There is some technical error, please try again!',
                        type: "error",
                        mode: "dark",
                    });
                }
            }
        });
    }

        function datepicker() {
        var startDate = new Date(ClassStartDateGlobal);
        var endDate = new Date(ClassEndDateGlobal);

        var formattedStartDate = formatDate(startDate);
        var formattedEndDate = formatDate(endDate);

        // Set the min and max attributes for the date input
        document.getElementById('Business_StartDate').setAttribute('min', formattedStartDate);
        document.getElementById('Business_StartDate').setAttribute('max', formattedEndDate);
    }
    function formatDate(date) {
        var day = date.getDate().toString().padStart(2, '0');
        var month = (date.getMonth() + 1).toString().padStart(2, '0');
        var year = date.getFullYear();

        return `${year}-${month}-${day}`;
    }
    function ChooseEndDate() {
        var StartDate = $("#Business_StartDate").val();

        var start_Date = new Date(StartDate);
        var endDate = new Date(ClassEndDateGlobal);

        var formattedStartDate = formatDate(start_Date);
        var formattedEndDate = formatDate(endDate);

        // Set the min and max attributes for the date input
        document.getElementById('Business_EndDate').setAttribute('min', formattedStartDate);
        document.getElementById('Business_EndDate').setAttribute('max', formattedEndDate);
    }

    // To Open the Model
    function ClassModelRequestDetail(name, classBookingId, endDate, startDate) {
        $('#EditBusinessPauseClassModal').modal('show');
        $("#BusinessDetails_EditBusinessPauseModal").html('');
        $("#BusinessDetails_EditBusinessPauseModal").append(name);
        ClassBookingIdGlobal = classBookingId;
        ClassEndDateGlobal = endDate;
        ClassStartDateGlobal = startDate;
    }

    function ResetAddPauseClassView() {
        $("#BusinessDetails_EditBusinessPauseModal").val('');
        $("#Business_StartDate").val('');
        $("#Business_EndDate").val('');
        $("#txtDescription").val('');
        $("#Business_PauseDays").val('');
    }






    function updatePauseDays() {
        var startDateValue = document.getElementById('Business_StartDate').value;
        var endDateValue = document.getElementById('Business_EndDate').value;

        // Check if both StartDate and EndDate are selected
        if (startDateValue && endDateValue) {
            var startDate = new Date(startDateValue);
            var endDate = new Date(endDateValue);

            // Check if the dates are valid
            if (!isNaN(startDate) && !isNaN(endDate)) {
                // Calculate the difference in days
                var timeDiff = endDate - startDate;
                var daysDiff = Math.ceil(timeDiff / (1000 * 3600 * 24));

                // Update the "Pause Days" field
                document.getElementById('Business_PauseDays').value = daysDiff;
            } else {
                // If either StartDate or EndDate is not valid, display a message or handle it as needed
                document.getElementById('Business_PauseDays').value = "Invalid date(s)";
            }
        } else {
            // If either StartDate or EndDate is not selected, display nothing
            document.getElementById('Business_PauseDays').value = "";
        }
    }

    // Attach the function to the change event of the start and end date inputs
    document.getElementById('Business_StartDate').addEventListener('change', updatePauseDays);
    document.getElementById('Business_EndDate').addEventListener('change', updatePauseDays);



      function btnPauseClassFormClick() {
    //console.log('submission disabled!');
    //return;
    let is_valid = true;
      $(".error-class").html('');
        var _mode = 1;

        let _startDate = $("#Business_StartDate").val();
        let _endDate = $("#Business_EndDate").val().trim();
        let _reason = $("#txtDescription").val().trim();
        let _pausedays = $("#Business_PauseDays").val();

        let _error_startDate = $("#error_Business_StartDate");
        let _error_endDate = $("#error_Business_EndDate");
        let _error_reason = $("#error_txtDescription");



        if (validate_IsEmptyStringInputFieldValue(_startDate)) {
        is_valid = false;
            _error_startDate.html('@(Resources.VisitorPanel.StartDateRequired)');
    }
        if (validate_IsEmptyStringInputFieldValue(_endDate)) {
        is_valid = false;
            _error_endDate.html('@(Resources.VisitorPanel.EndDateRequired)');
    }
        if (validate_IsEmptyStringInputFieldValue(_reason)) {
        is_valid = false;
            _error_reason.html('@(Resources.VisitorPanel.ReasonRequired)');
        }



    if (is_valid) {


        var data = new FormData();

        data.append("PauseStartDate", _startDate);
        data.append("PauseEndDate", _endDate);
        data.append("PauseDays", _pausedays);
        data.append("Reason", _reason);
        data.append("Mode", _mode);

        $.ajax({
            url: '/api/Class/AddPauseRequest?classBookingId=' + ClassBookingIdGlobal,
            data: data,
            processData: false,
            mimeType: 'multipart/form-data',
            contentType: false,
            //contentType: 'application/json',
            headers: {
                "Authorization": "Bearer " + UserToken_Global
            },
            type: 'POST',
            success: function (dataResponse) {

                //--Parse into Json of response-json-string
                dataResponse = JSON.parse(dataResponse);

                //--If successfully added
                if (dataResponse.status === 1) {
                    swal("Success!", dataResponse.message, "success");
                    ResetAddPauseClassView();
                    $('#EditBusinessPauseClassModal').modal('hide');
                    GetAllStudentActiveClasses();
                }
                else {
                    $.iaoAlert({
                        msg: dataResponse.message,
                        type: "error",
                        mode: "dark",
                    });

                    StopLoading();

                }

            },
            error: function (result) {
                StopLoading();


                if (result["status"] == 401) {
                    $.iaoAlert({
                        msg: '@(Resources.ErrorMessage.UnAuthorizedErrorMessage)',
                        type: "error",
                        mode: "dark",
                    });
                }
                else {
                    $.iaoAlert({
                        msg: '@(Resources.ErrorMessage.TechincalErrorMessage)',
                        type: "error",
                        mode: "dark",
                    });
                }
            }
        });
    }
}






    ////// -----------    FIELD VALIDATION HANDLER FUNCTIONS  --------------------------

    const validate_IsEmptyStringInputFieldValue = function (inputFieldValue) {
        if (inputFieldValue == '' || inputFieldValue.replace(/\s/g, "") == "")
            return true;
        return false;
    }

    const validate_IsEmptySelectInputFieldValue = function (inputFieldValue) {
        if (inputFieldValue == undefined || inputFieldValue == null || inputFieldValue == '' || inputFieldValue == 0)
            return true;
        return false;
    }
    ////// -----------    FIELD VALIDATION HANDLER FUNCTIONS  --------------------------



    function GetAllStudentActiveClasses() {

        $.ajax({
            type: "GET",
            url: '/api/Student/GetAllActiveCourse?lastRecordId=0',
            headers: {
                "Authorization": "Bearer " + UserToken_Global,
                "Content-Type": "application/json"
            },
            contentType: 'application/json',
            success: function (response) {
                if (response.status < 1) {
                    $.iaoAlert({
                        msg: response.message,
                        type: "error",
                        mode: "dark",
                    });
                    return;
                }
                var classList = '';

                $('#BindActiveClassDetail').html('');
                if (response.data.length <= 0) {
                    // No data, show a message
                    $('#BindActiveClassDetail').html('<div class="w-100 text-black-50 text-center mt-4"><i>You don\'t have any Active Classes!</i></div>');
                    $('#BtnViewMoreUpcomingActiveClass').addClass('d-none');
                    StopLoading();
                    return;
                }
                for (var i = 0; i < response.data.length; i++) {
                    if (response.data.length < recordLimit) {
                        $("#BtnViewMoreUpcomingActiveClass").addClass('btnViewMoreUpcomingClass');
                    } else {
                        $("#BtnViewMoreUpcomingActiveClass").removeClass('d-none');
                    }
                    var starIcons = '';

                    if (response.data[i].AverageRating) {
                        rating = response.data[i].AverageRating;

                        for (var j = 1; j <= 5; j++) {
                            if (j <= rating) {
                                starIcons += ' <i class="fa-solid fa-star rating-star-filled" style="color: #f3a762";></i>';
                            } else {
                                starIcons += `<i class="fa-solid fa-star rating-star-empty"></i>`;

                            }
                        }
                    }
                    else {
                        for (var j = 1; j <= 5; j++) {
                            starIcons += `<i class="fa-solid fa-star rating-star-empty"></i>`;
                        }
                    }

                    
                    var PauseClassRequestbtn = '';
                    //if (response.data[i].Status == 3 || response.data[i].Status == 0) {
                    if (response.data[i].CanPauseClass == 1) {
                        PauseClassRequestbtn = `
                        <a class="pause-cta" href="javascript:;" onclick="ClassModelRequestDetail('${response.data[i].Name}',${response.data[i].Id},'${response.data[i].EndDate}','${response.data[i].StartDate}')">Pause Class</a>
                    `;
                    }
                    else {
                        if (response.data[i].Classpausestatus == 1) {
                            PauseClassRequestbtn = '<p>Pause Class Status</p><a href="/Home/StudentPauseClassRequest"><span class="bg-warning text-white">Pending</span></a>';
                        } else if (response.data[i].Classpausestatus == 2   ) {
                            PauseClassRequestbtn = '<p>Pause Class Status</p><a href="/Home/StudentPauseClassRequest"><span class="bg-success text-white">Approved</span></a>';
                        } else if (response.data[i].Classpausestatus == 3) {
                            PauseClassRequestbtn = '<p>Pause Class Status</p><a href="/Home/StudentPauseClassRequest"><span class="bg-danger text-white">Rejected</span></a>';
                        }
                    }
                   

                    if (response.data[i].ClassMode == 'Online') {

                        var onlineclassdetails = `
                            <div class="classinfosection">
                            <p class="password-join-title">Online class link and password</p>
                            </div>
                            <div class="password-join">
                            <div class="password-join-iner">
                                <div class="passwords">
                                    ${response.data[i].ClassURLLinkPassword} <i class="fa fa-clone d-none" onclick="copyPassword(this)"></i>
                                    <span class="tooltiptext">Text copied!</span>
                                </div>
                                <div class="border-left-pass"></div>
                                <div class="join-iner">
                                    <a href="${response.data[i].OnlineClassLink}">Click to join</a>
                                </div>
                            </div>
                            </div>
                        `;
                    }
                    
                    else
                    {
                        onlineclassdetails = ``;
                    }
                   
                    var Description = ``;
                    var truncatedDescription = response.data[i].Description;
                    var maxLength = 100;
                    var readMoreHtml = '<a href="#" class="read-more">Read more</a>';
                    var showLessHtml = '<a href="#" class="read-less">Show less</a>';
                    if (truncatedDescription.length > maxLength) {
                        truncatedDescription = truncatedDescription.substr(0, maxLength) + '.';
                    }
                    if (response.data[i].Description.length < maxLength) {

                        Description = '<span class="description"><span class="full-description">' + response.data[i].Description + '.';

                    } else {

                        Description = '<span class="description"><span class="full-description d-none">' + response.data[i].Description + '.' + showLessHtml + '</span ><span class="truncated-description">' + truncatedDescription + '.' + readMoreHtml + '</span></span> ';
                    }

                    var _startDate = response.data[i].StartDate;
                    var dateParts = _startDate.split("-");
                    var _formattedStartDate = dateParts[2] + "-" + dateParts[1] + "-" + dateParts[0];


                    var _endDate = response.data[i].EndDate;
                    var dateParts = _endDate.split("-");
                    var _formattedEndDate = dateParts[2] + "-" + dateParts[1] + "-" + dateParts[0]; 





                    var classList = `<div class="active-class-main"><div class="active-class-tab">
                                        <div class="active-class-tab-iner">
                                            <div class="logo-img-iner">
                                                <img src="${response.data[i].BusinessProfileImage}" alt="logo" loading="lazy">
                                            </div>
                                            <div class="text-title-start">
                                                <div class="text-iner">
                                                    <h6> ${response.data[i].BusinessName}</h6>

                                                </div>
                                                <div class="text-start">
                                                   
                                                    <span>
                                                       ${starIcons}
                                                    </span>

                                                </div>
                                                <div class="classModeSection"><span style="color:white;">${response.data[i].ClassMode}</span></div>
                                            </div>
                                        </div>
                                        <div class="active-class-tab-iner">
                                            <div class="guitar-img-iner">
                                                <img src="${response.data[i].ImageWithPath}" alt="logo" loading="lazy">
                                            </div>
                                            <div class="text-title-start">
                                                <div class="text-iner">
                                                    <h6>${response.data[i].Name}</h6>
                                                    <p>${response.data[i].Price}/${response.data[i].ClassPriceType}</p>
                                                </div>
                                                <div class="active-click-down">
                                                    <div class="text-start d-flex">
                                                        <a href="#">active</a>
                                                       
                                                    </div>
                                                    <div class="arrow-down">
                                                        <i class="fa-solid fa-angle-down"></i>
                                                    </div>
                                                </div>

                                            </div>
                                        </div>
                                    </div>

                                    <div class="active-class-item">
                                        <div class="active-class-item-flex">
                                            <div class="active-class-item-iner">
                                                <div class="img-in-text-img">
                                                    <img src="${response.data[i].GroupImageWithPath}" alt="img" loading="lazy">

                                                </div>
                                                <Div class="img-in-text-in">
                                                    <p>${response.data[i].GroupName}</p>
                                                    <p>
                                                        <span>${response.data[i].ClassDays_ShortForm}</span>
                                                        <span class="time-cl">${response.data[i].ScheduledStartOnTime_24HF} to ${response.data[i].ScheduledEndOnTime_24HF}</span>
                                                    </p>

                                                </Div>
                                            </div>
                                            <div class="active-class-item-iner second-child">

                                                <div class="img-in-pro-img">
                                                    <img src="${response.data[i].ProfileImageWithPath}" alt="img" loading="lazy">

                                                </div>
                                                <div class="img-in-text-in">
                                                    <p class="profile-name">
                                                        <span class="verified"><i class="fa-solid fa-circle-check"></i></span>
                                                      ${response.data[i].BusinessOwnerName}
                                                    </p>
                                                    <p> ID ${response.data[i].MasterId}</p>
                                                    <p>${response.data[i].BusinessCategoryName}</p>

                                                </div>
                                            </div>
                                        </div>
                                        <div class="button-iner">
                                            <a href="/Home/MessageChat?toUserLoginId=${encodeURIComponent(response.data[i].EncryptedUserLoginId)}">Message</a>
                                            <a href="#">
                                                <span><i class="fa-solid fa-clipboard-user"></i></span>
                                                Attendance
                                            </a>
                                            <a href="#">
                                                <span><i class="fa-solid fa-file-invoice"></i></span>
                                                Invoice
                                            </a>
                                        </div>

                                        <div class="date-details-pause">
                                            <div class="start-end-date-iner">
                                                <div class="start-date">
                                                    <p>start Date</p>
                                                    <span class="date-style">${_formattedStartDate}</span>
                                                </div>
                                                <div class="start-date">
                                                    <p>Expire On</p>
                                                    <span class="Expire-style">${_formattedEndDate}</span>
                                                </div>
                                            </div>
                                            <div class="pause-btn">
                                                ${PauseClassRequestbtn}
                                            </div>
                                        </div>
                                         ${onlineclassdetails}
                                        <div class="des-text">
                                            <p>
                                                ${Description}
                                            </p>
                                        </div>
                                    </div></div>`;

                    $("#BindActiveClassDetail").append(classList);
                }
                // Check if there is more data to load
                if (response.data.length > 0) {
                    ActiveClass_LastRecordedId_Global = response.data[response.data.length - 1].Id;
                    $('#BtnViewMoreUpcomingActiveClass').removeClass('d-none');
                } else {
                    // No more data, hide the "View More" button
                    $('#BtnViewMoreUpcomingActiveClass').addClass('d-none');
                }
               
                // for read more show less functionality of description
                $(document).on('click', '.read-more', function (e) {
                    e.preventDefault();
                    $(this).closest('.description').find('.full-description').removeClass('d-none');
                    $(this).closest('.description').find('.truncated-description').addClass('d-none');
                });
                $(document).on('click', '.read-less', function (e) {
                    e.preventDefault();
                    $(this).closest('.description').find('.full-description').addClass('d-none');
                    $(this).closest('.description').find('.truncated-description').removeClass('d-none');
                });
                StopLoading();
            },
            error: function (result) {
                // StopLoading();

                if (result["status"] == 401) {
                    $.iaoAlert({
                        msg: 'Unauthorized! Invalid Token!',
                        type: "error",
                        mode: "dark",
                    });
                }
                else {
                    $.iaoAlert({
                        msg: 'There is some technical error, please try again!',
                        type: "error",
                        mode: "dark",
                    });
                }
            }
        });
    }

    //function bussinessMessage(businessOwnerLoginId) {

    //    var OwnerId_Global = EDClass.Decrypt(businessOwnerLoginId);
    //    window.location.href = '/Home/MessageChat?toUserLoginId=' + OwnerId_Global;
    //}


    $(document).on('click', '.active-class-tab .arrow-down', function (event) {
        event.preventDefault();

        // Find the corresponding .active-class-item
        var dropDown = $(this).closest('.active-class-main').find('.active-class-item');

        // Close all other .active-class-item elements
        $('.active-class-item').not(dropDown).slideUp();

        // Toggle active class on arrow-down icon
        $(this).toggleClass('active');

        // Toggle visibility of the corresponding .active-class-item
        dropDown.stop(false, true).slideToggle();
    });

   
   

   

  

</script>
